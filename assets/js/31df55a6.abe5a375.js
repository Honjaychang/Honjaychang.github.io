"use strict";(self.webpackChunkmy_test=self.webpackChunkmy_test||[]).push([[5868],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},i={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},l=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=d(e,["components","mdxType","originalType","parentName"]),l=p(n),m=r,k=l["".concat(s,".").concat(m)]||l[m]||i[m]||a;return n?o.createElement(k,c(c({ref:t},u),{},{components:n})):o.createElement(k,c({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,c=new Array(a);c[0]=l;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:r,c[1]=d;for(var p=2;p<a;p++)c[p]=n[p];return o.createElement.apply(null,c)}return o.createElement.apply(null,n)}l.displayName="MDXCreateElement"},5538:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return l}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),c=["components"],d={},s="Redux",p={unversionedId:"react/redux",id:"react/redux",isDocsHomePage:!1,title:"Redux",description:"redux\u539f\u7406\u56fe",source:"@site/docs/react/redux.md",sourceDirName:"react",slug:"/react/redux",permalink:"/docs/react/redux",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"React \u57fa\u7840",permalink:"/docs/react/basic"},next:{title:"Hooks",permalink:"/docs/react/hooks"}},u=[{value:"TodoList \u6f14\u7ec3",id:"todolist-\u6f14\u7ec3",children:[]}],i={toc:u};function l(e){var t=e.components,n=(0,r.Z)(e,c);return(0,a.kt)("wrapper",(0,o.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"redux"},"Redux"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/redux.png",alt:"redux\u539f\u7406\u56fe"})),(0,a.kt)("p",null,"Model-State-View"),(0,a.kt)("p",null,"store view action"),(0,a.kt)("p",null,"Store \u5bf9\u5e94 stateManager/state"),(0,a.kt)("p",null,"Action \u5bf9\u5e94 StateManager/updater"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"View \u901a\u8fc7\u76d1\u542c\u83b7\u53d6 State \u6570\u636e"),(0,a.kt)("li",{parentName:"ol"},"\u7528\u6237\u4e8b\u4ef6\u89e6\u53d1\u65f6\uff0cView \u4e0a\u7684\u903b\u8f91\u5c06\u8c03\u7528 StateManager/Updater \u65b9\u6cd5\u6765\u89e6\u53d1 State \u66f4\u65b0\u903b\u8f91"),(0,a.kt)("li",{parentName:"ol"},"StateManager/Updater \u6267\u884c\u8ba1\u7b97\uff0c\u5e76\u66f4\u65b0 State \u6570\u636e"),(0,a.kt)("li",{parentName:"ol"},"State \u6570\u636e\u66f4\u65b0\u540e\uff0c\u901a\u77e5\u76d1\u542c\u8be5 State \u7684 View \u66f4\u65b0\u89c6\u56fe")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"dispatch \u5206\u53d1\n\n\u521d\u59cb\u5316 type:@@init@@  previousState undefined\naction \u52a8\u4f5c\u5bf9\u8c61\n    type    \u6807\u8bc6\u5c5e\u6027 string \u552f\u4e00 \u5fc5\u8981\u5c5e\u6027\n  data  \u6570\u636e\u5c5e\u6027 any \u53ef\u9009\u5c5e\u6027\n\n\nreducer\n    \u7528\u4e8e\u521d\u59cb\u5316\u72b6\u6001 \u52a0\u5de5\u72b6\u6001\n  \u52a0\u5de5\u65f6\uff0c\u6839\u636e\u65e7\u7684state \u548c action \u4ea7\u751f\u65b0\u7684state\u7684\u7eaf\u51fd\u6570\n\nstore\n    \u5c06state action reducer \u8054\u7cfb\u5728\u4e00\u8d77\n\nimport { createStore } from 'redux'\nimport reducer from './reducers'\nconst store = createStore(reducer)\n")),(0,a.kt)("p",null,"yarn add redux-thunk"),(0,a.kt)("p",null,"react-redux"),(0,a.kt)("p",null,"facebook \u51fa\u54c1\u7684\u81ea\u5df1\u7684 redux"),(0,a.kt)("p",null,"\u6240\u6709\u7684 UI \u7ec4\u4ef6\u90fd\u5e94\u8be5\u5305\u88f9\u4e00\u4e2a\u5bb9\u5668\u7ec4\u4ef6 \u4ed6\u4eec\u662f\u7236\u5b50\u5173\u7cfb"),(0,a.kt)("p",null,"\u5bb9\u5668\u7ec4\u4ef6\u662f\u771f\u6b63\u548c redux \u6253\u4ea4\u9053\u7684\uff0c\u91cc\u9762\u53ef\u4ee5\u968f\u610f \u7684\u4f7f\u7528 redux \u7684 api"),(0,a.kt)("p",null,"UI \u7ec4\u4ef6\u4e2d\u4e0d\u80fd\u4f7f\u7528\u4efb\u4f55 redux \u7684 api"),(0,a.kt)("p",null,"\u5bb9\u5668\u7ec4\u4ef6\u4f1a\u4f20\u7ed9 UI \u7ec4\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"redux \u4e2d\u6240\u4fdd\u5b58\u7684\u72b6\u6001"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u64cd\u4f5c\u72b6\u6001\u7684\u65b9\u6cd5")),(0,a.kt)("p",null,"\u5907\u6ce8\uff1a\u5bb9\u5668\u7ed9 UI \u4f20\u9012 \u72b6\u6001\u65b9\u6cd5\u64cd\u4f5c\u72b6\u6001\u7684\u65b9\u6cd5 \u5747\u901a\u8fc7 props \u4f20\u9012"),(0,a.kt)("p",null,"redux"),(0,a.kt)("p",null,"yarn add redux-devtools-extension"),(0,a.kt)("p",null,"Store"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"01 - redux\u5b8c\u6574\u7248;\n\nthis.setState({ count: count + value });\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"- redux\n    - actions\n        - count.js\n    - reducers\n        - count.js\n    - store.js\n  - constant.js\n\n// \u8be5\u6a21\u5757\u7528\u4e8e\u5b9a\u4e49action\u5bf9\u8c61\u4e2dtype\u7c7b\u578b\u7684\u5e38\u91cf\u503c\nexport const INCREMENT = 'increment'\n\n\n// Count/index.js\n// store.dispatch({type: 'increment', data: value})\nstore.dispatch(createIncrementAction(value))\n\nstore.getState() VS \u4e4b\u524d\u7684this.state.count\n\n// index.js\n// \u53ea\u8981 redux \u4e2d\u503c\u53d1\u751f\u53d8\u5316 \u65e7 render  DOM diff\nstore.subscribe(() => {\n  ReactDOM.render(<App />, document.getElementById('root'))\n})\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"action")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"// action\u6587\u4ef6\u4e13\u95e8\u4e3a count\u7ec4\u4ef6 \u521b\u5efa action\u5bf9\u8c61\nimport { INCREMENT } from './constant';\nexport const createIncrementAction = data => ({ type: INCREMENT, data });\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"reducer")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"// redux/reducer \u6587\u4ef6\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u4e3aCount\u7ec4\u4ef6\u670d\u52a1\u7684reducer\n// reducer \u672c\u8d28\u662f\u4e00\u4e2a\u51fd\u6570 \u4f1a\u63a5\u5230\u4e24\u4e2a\u53c2\u6570 \u5206\u522b\u4e3a \u4e4b\u524d\u7684\u72b6\u6001 preState \u52a8\u4f5c\u5bf9\u8c61 action\nimport { INCREMENT } from './constant';\nconst initState = 0;\n// \u901a\u8fc7\u9ed8\u8ba4\u503c \u6765\u907f\u514d\u521d\u59cb\u5316\u4e3aundefined\u7684\u60c5\u51b5\nfunction countReducer(preState = initState, action) {\n  // \u4ece action\u5bf9\u8c61\u4e2d\u83b7\u53d6 type\u3001data\n  const { type, data } = action;\n  // \u6839\u636etype\u51b3\u5b9a\u5982\u4f55\u52a0\u5de5\u6570\u636e\n  switch (type) {\n    case INCREMENT:\n      return preState + data;\n    default:\n      return preState;\n  }\n}\nexport default countReducer;\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"store")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"// store.js \u6587\u4ef6\u4e13\u95e8\u7528\u4e8e\u66b4\u9732\u4e00\u4e2astore\u5bf9\u8c61\n\n// \u4e13\u95e8\u7528\u4e8e\u521b\u5efa redux \u4e2d\u6700\u4e3a\u6838\u5fc3\u7684store\u5bf9\u8c61\nimport { createStore } from 'redux';\n// \u5f15\u5165\u4e3aCount\u7ec4\u4ef6\u670d\u52a1\u7684reducer\nimport countReducer from './count_reducer';\n\n// \u66b4\u9732 store\nexport default createStore(countReducer);\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"02 - redux\u5f02\u6b65action;\n\n// action \u53ef\u4ee5\u662fObject\uff08\u540c\u6b65\uff09  \u6216\u8005  function\uff08\u5f02\u6b65action\uff09\n\n// \u5f02\u6b65 action \u7684\u503c\u4e3a\u51fd\u6570  \u9700\u8981\u4e00\u4e2a\u4e2d\u95f4\u4ef6 \u4ea4\u7ed9store\u76f4\u63a5\u6267\u884c\u4e00\u4e0b\uff08\u65e0\u9700\u4ea4\u7ed9reducer\uff09\nexport const createIncrementAsyncAction = (data, time) => {\n  // return ()=>{\n  return dispatch => {\n    setTimeout(() => {\n      // store.dispatch({ type: INCREMENT, data })\n      // \u53ef\u4ee5\u4e0d\u7528\u81ea\u5df1\u5199 \u8c03\u7528\u540c\u6b65\u7684action\n      // store.dispatch(createIncrementAction(data))\n      // \u5f02\u6b65action \u4e00\u822c\u90fd\u4f1a\u8c03\u7528\u540c\u6b65action  \u5f02\u6b65action\u4e0d\u662f\u5fc5\u8981\u7684\n      dispatch(createIncrementAction(data));\n    }, time);\n  };\n};\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"react-redux")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"App.js\n// \u5f15\u5165containers \u4e0b\u7684 \u5bb9\u5668\u7ec4\u4ef6\nimport Count from './containers/Count'\nimport store from './redux/store'\n<Count store={store} />\n\n\n\n\nstore.js\n\n// \u4e13\u95e8\u7528\u4e8e\u521b\u5efa redux \u4e2d\u6700\u4e3a\u6838\u5fc3\u7684store\u5bf9\u8c61\nimport { createStore, applyMiddleware } from 'redux'\n// \u5f15\u5165\u4e3aCount\u7ec4\u4ef6\u670d\u52a1\u7684reducer\nimport countReducer from './count_reducer'\n\n// \u5f15\u5165redux-thunk \u7528\u4e8e\u652f\u6301\u5f02\u6b65action\nimport thunk from 'redux-thunk'\n\n// \u66b4\u9732 store\nexport default createStore(countReducer, applyMiddleware(thunk))\n\n\n\n\n\u5bb9\u5668\u7ec4\u4ef6    UI\u7ec4\u4ef6\n\n// \u5f15\u5165Count\u7ec4\u4ef6\u7684UI\u7ec4\u4ef6\nimport CountUI from '../../components/Count'\nimport {\n  createIncrementAction,\n} from '../../redux/count_action'\n/**\n * \u5f15\u5165 Redux \u91cc\u6700\u6838\u5fc3\u7684store\n * // import store from '../../redux/store'\n * \u4f46\u662f store \u4e0d\u80fd\u81ea\u5df1\u5f15\u5165 \u9700\u8981\u901a\u8fc7props \u4f20\u9012\n */\n\n// \u5f15\u5165 connect  \u7528\u4e8e\u94fe\u63a5UI\u7ec4\u4ef6\u4e0eredux\nimport { connect } from 'react-redux'\n\n/**\n * 1\u3001mapStateToProps \u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\n * 2\u3001\u8fd4\u56de\u5bf9\u8c61\u4e2d\u7684key\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684key value\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684value\uff08\u72b6\u6001\uff09\n * 3\u3001mapStateToProps \u7528\u4e8e\u4f20\u9012\u72b6\u6001\n */\nconst mapStateToProps = (state) => ({ count: state })\n/**\n * 1\u3001mapDispatchToProps \u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\n * 2\u3001\u8fd4\u56de\u5bf9\u8c61\u4e2d\u7684key\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684key value\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684value\n * 3\u3001mapDispatchToProps \u7528\u4e8e\u5b8c\u6210 \u64cd\u4f5c\u72b6\u6001\u7684\u65b9\u6cd5\n */\nconst mapDispatchToProps = (dispatch) => {\n  // \u901a\u77e5redux\u6267\u884c\u52a0\u6cd5\n  return {\n    increment: (number) => dispatch(createIncrementAction(number)),\n  }\n}\n\n/**\n * \u4f7f\u7528connect()()  \u521b\u5efa\u66b4\u9732    \u5efa\u7acb\u8fde\u63a5   connect \u5f62\u6210 \u7236\u5b50\u7ec4\u4ef6\u5173\u7cfb\n * connect \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e24\u4e2a\u51fd\u6570  \u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f5c\u4e3a\u72b6\u6001\u4f20\u9012\u7ed9\u4e86UI\u7ec4\u4ef6\n */\nexport default connect(mapStateToProps, mapDispatchToProps)(CountUI)\n\n\n\nthis.props.increasement(value)\n")),(0,a.kt)("p",null,"\u4f18\u5316 ",(0,a.kt)("inlineCode",{parentName:"p"},"dispatch")," ",(0,a.kt)("inlineCode",{parentName:"p"},"provider")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"export default connect(\n  (state) => ({ count: state }),\n  // mapDispatchToProps \u7b80\u5199 react-redux \u4f1a\u5e2e\u4f60dispatch\n  {\n    increment: createIncrementAction,\n    decrement: createDecrementAction,\n    incrementAsync: createIncrementAsyncAction,\n  }\n)(CountUI)\n\n\n\n\n// \u901a\u8fc7 react-redux \u5c31\u4e0d\u9700\u8981\u518d\u6b21\u76d1\u6d4b  \u5bb9\u5668\u7ec4\u4ef6\u5df2\u7ecf\u5177\u5907\u76d1\u6d4b\u76d1\u6d4b\u80fd\u529b\n<Provider store={store}>\n  <App />\n</Provider>\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import { composeWithDevTools } from 'redux-devtools-extension';\n\n// \u66b4\u9732 store\nexport default createStore(\n  allReducers,\n  composeWithDevTools(applyMiddleware(thunk))\n);\n\n// \u8be5\u6587\u4ef6\u7528\u6765\u6c47\u603b\u6240\u6709\u7684reducer\n\nimport count from './count';\nimport persons from './person';\n\nimport { combineReducers } from 'redux';\n\n// \u6c47\u603b\u6240\u6709\u7684reducers\nexport const allReducers = combineReducers({\n  count: count,\n  persons: persons,\n});\n")),(0,a.kt)("p",null,"\u5185\u90e8\u8fd0\u884c\u673a\u5236 \u8bbe\u8ba1\u539f\u7406"),(0,a.kt)("p",null,"\u6570\u636e\u9a71\u52a8\u66f4\u65b0"),(0,a.kt)("h2",{id:"todolist-\u6f14\u7ec3"},"TodoList \u6f14\u7ec3"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"-src -\n  components -\n  Item -\n  index.jsx -\n  List -\n  index.jsx -\n  redux -\n  actions.js -\n  reducers.js -\n  store.js -\n  constant.js -\n  App.js -\n  index.js;\n")),(0,a.kt)("h4",{id:"basic"},"Basic"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"index.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"App.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react';\nimport List from './components/List';\nfunction App() {\n  return (\n    <React.Fragment>\n      <List />\n    </React.Fragment>\n  );\n}\n\nexport default App;\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"List/index.jsx"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { Component } from 'react';\nimport Item from '../Item';\n\nlet uid = 3;\nexport default class List extends Component {\n  addTodo = e => {\n    // const { todos } = this.state;\n    if (e.keyCode !== 13) return;\n    const newTodo = { id: uid++, value: e.target.value };\n    this.setState({ todos: [newTodo, ...this.state.todos] });\n    e.target.value = '';\n  };\n  deleteTodo = id => {\n    const { todos } = this.state;\n    const newTodos = todos.filter(todo => todo.id !== id);\n    this.setState({ todos: newTodos });\n  };\n\n  render() {\n    const { todos } = this.state;\n    return (\n      <React.Fragment>\n        <h5>Todo List</h5>\n        <input onKeyUp={this.addTodo} />\n        {todos.map(todo => {\n          return <Item key={todo.id} {...todo} deleteTodo={this.deleteTodo} />;\n        })}\n      </React.Fragment>\n    );\n  }\n}\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"Item/index.jsx"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { Component } from 'react';\n\nexport default class Item extends Component {\n  deleteItem = id => {\n    this.props.deleteTodo(id);\n  };\n  render() {\n    const { id, value } = this.props;\n    return (\n      <React.Fragment>\n        <li onClick={() => this.deleteItem(id)}>{value}</li>\n      </React.Fragment>\n    );\n  }\n}\n")),(0,a.kt)("h4",{id:"redux-1"},"Redux"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," ",(0,a.kt)("inlineCode",{parentName:"p"},"add..."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import store from './redux/store';\n\n//\nstore.subscribe(() =>\n  ReactDOM.render(<App />, document.getElementById('root'))\n);\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"App.js"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"List/index.jsx"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { Component } from 'react';\nimport Item from '../Item';\nimport {\n  addTodoAction,\n  deleteTodo,\n  countAdd,\n  countAddAsync,\n} from '../../redux/actions';\nimport store from '../../redux/store';\n\nlet uid = 3;\nexport default class List extends Component {\n  addTodo = e => {\n    if (e.keyCode !== 13) return;\n    const newTodo = { id: uid++, value: e.target.value };\n    store.dispatch(addTodoAction(newTodo));\n    e.target.value = '';\n  };\n  deleteTodo = id => {\n    store.dispatch(deleteTodo(id));\n  };\n\n  plus = num => {\n    store.dispatch(countAdd(num));\n  };\n  asyncPlus = num => {\n    store.dispatch(countAddAsync(num, 1000));\n  };\n\n  render() {\n    const todos = store.getState().todossss;\n    const num = store.getState().count;\n    return (\n      <React.Fragment>\n        <h5>Todo List</h5>\n        <input onKeyUp={this.addTodo} />\n        {todos.map(todo => {\n          return <Item key={todo.id} {...todo} deleteTodo={this.deleteTodo} />;\n        })}\n        <h5>counter: {num}</h5>\n        <button onClick={() => this.plus(num)}>Plus</button>\n        <button onClick={() => this.asyncPlus(num)}>Plus Async</button>\n      </React.Fragment>\n    );\n  }\n}\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"Item/index.jsx"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"constant.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"export const ADD_TODO = 'addTodo';\nexport const DELETE_TODO = 'deleteTodo';\n\nexport const COUNT_ADD = 'countAdd';\nexport const COUNT_ADD_ASYNC = 'countAddAsync';\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"action.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ADD_TODO, DELETE_TODO, COUNT_ADD } from './constant';\n\n// action \u521b\u5efa\u51fd\u6570 \u7b80\u5199 + \u975e\u7b80\u5199\n// \u901a\u8fc7 action \u521b\u5efa\u51fd\u6570 addTodoAction \u6765\u521b\u5efa action ADD_TODO\nexport function addTodoAction(todo) {\n  return { type: ADD_TODO, todo };\n}\n\nexport const deleteTodo = id => ({ type: DELETE_TODO, id });\n\nexport const countAdd = num => ({ type: COUNT_ADD, num });\nexport const countAddAsync = (num, delay) => {\n  // return () => {\n  //   setTimeout(() =>{\n  //     store.dispatch({ type: ADD_ADD_ASYNC, num})\n  //   },delay);\n  // }\n  return dispatch => {\n    setTimeout(() => {\n      dispatch(countAdd(num));\n    }, delay);\n  };\n};\n\n// dispatch(deleteTodo(id))\n\n// \u521b\u5efa\u4e00\u4e2a \u88ab\u7ed1\u5b9a\u7684 action \u521b\u5efa\u51fd\u6570 \u6765\u81ea\u52a8 dispatch\n// const boundDeleteTodo = id => dispatch(deleteTodo(id))\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"reducers.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ADD_TODO, DELETE_TODO, COUNT_ADD } from './constant';\n\nconst initState = {\n  todos: [\n    { id: 1, value: 'abc' },\n    { id: 2, value: 'cba' },\n  ],\n  count: 0,\n};\n\nexport const todoReducer = (state = initState.todos, action) => {\n  switch (action.type) {\n    case ADD_TODO:\n      // return { todos: [action.todo, ...state.todos] };\n      return [action.todo, ...state];\n    case DELETE_TODO:\n      // return { todos: state.todos.filter(todo => todo.id !== action.id) };\n      return state.filter(todo => todo.id !== action.id);\n    default:\n      return state;\n  }\n};\n\nexport const count = (state = initState.count, action) => {\n  switch (action.type) {\n    case COUNT_ADD:\n      const count = action.num + 1;\n      return count;\n    default:\n      return state;\n  }\n};\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"store.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { createStore, combineReducers, applyMiddleware } from 'redux';\nimport { todoReducer, count } from './reducers';\n// \u5f15\u5165redux-thunk \u7528\u4e8e\u652f\u6301\u5f02\u6b65action\nimport thunk from 'redux-thunk';\n\nconst allReducers = combineReducers({ todossss: todoReducer, count });\n\nexport default createStore(allReducers, applyMiddleware(thunk));\n")),(0,a.kt)("h4",{id:"react-redux"},"React-redux"),(0,a.kt)("p",null,"\u533a\u5206\u5bb9\u5668\u7ec4\u4ef6",(0,a.kt)("inlineCode",{parentName:"p"},"containers"),"\u548c UI \u7ec4\u4ef6",(0,a.kt)("inlineCode",{parentName:"p"},"components")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"react-redux")," \u91cc\u9762\u7684 store \u9700\u8981\u81ea\u5df1 \u81ea\u5df1\u901a\u8fc7 props \u4f20\u9012"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," ",(0,a.kt)("inlineCode",{parentName:"p"},"add..."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport store from './redux/store';\nimport { Provider } from 'react-redux';\n\n// \u901a\u8fc7\u5728index.js\u4e2d\u7ed9App\u7ec4\u4ef6 \u901a\u8fc7Provider \u4f20\u9012props store \u6765\u907f\u514d\u7ed9\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u8981\u4f20\u9012\n// \u901a\u8fc7 react-redux \u5c31\u4e0d\u9700\u8981\u518d\u6b21\u76d1\u6d4b  \u5bb9\u5668\u7ec4\u4ef6\u5df2\u7ecf\u5177\u5907\u76d1\u6d4b\u76d1\u6d4b\u80fd\u529b\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"App.js"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"List/index.jsx"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { Component } from 'react';\nimport Item from '../Item';\nimport {\n  addTodoAction,\n  deleteTodo,\n  countAdd,\n  countAddAsync,\n} from '../../redux/actions';\n\n// \u5f15\u5165 connect  \u7528\u4e8e\u94fe\u63a5UI\u7ec4\u4ef6\u4e0eredux\nimport { connect } from 'react-redux';\n\nlet uid = 3;\nclass List extends Component {\n  addTodo = e => {\n    if (e.keyCode !== 13) return;\n    const newTodo = { id: uid++, value: e.target.value };\n    this.props.addTodoAction(newTodo);\n    e.target.value = '';\n  };\n  deleteTodo = id => {\n    this.props.deleteTodo(id);\n  };\n  plus = num => {\n    // console.log(num);\n    this.props.countAdd(num);\n  };\n\n  asyncPlus = num => {\n    this.props.countAddAsync(num, 1000);\n  };\n\n  render() {\n    const todos = this.props.todos;\n    const num = this.props.count;\n    return (\n      <React.Fragment>\n        <h5>Todo List</h5>\n        <input onKeyUp={this.addTodo} />\n        {todos.map(todo => {\n          return <Item key={todo.id} {...todo} deleteTodo={this.deleteTodo} />;\n        })}\n        <h5>counter: {num}</h5>\n        <button onClick={() => this.plus(num)}>Plus</button>\n        <button onClick={() => this.asyncPlus(num)}>Plus Async</button>\n      </React.Fragment>\n    );\n  }\n}\nexport default connect(\n  state => ({ todos: state.todossss, count: state.count }),\n  {\n    addTodoAction: addTodoAction,\n    deleteTodo: deleteTodo,\n    countAdd: countAdd,\n    countAddAsync: countAddAsync,\n  }\n)(List);\n\n\n\n// \ud83d\udc46\u4e0a\u9762\u662f\u7b80\u5199\n/**\n * 1\u3001mapStateToProps \u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61  \u7528\u4e8e\u4f20\u9012\u72b6\u6001\n * 2\u3001\u8fd4\u56de\u5bf9\u8c61\u4e2d\u7684key\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684key value\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684value\uff08\u72b6\u6001\uff09\n */\nconst mapStateToProps = state => ({\n  todos: state.todossss,\n  count: state.count,\n});\n/**\n * 1\u3001mapStateToProps \u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61  \u7528\u4e8e\u5b8c\u6210 \u64cd\u4f5c\u72b6\u6001\u7684\u65b9\u6cd5\n * 2\u3001\u8fd4\u56de\u5bf9\u8c61\u4e2d\u7684key\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684key value\u5c31\u4f5c\u4e3a\u4f20\u9012\u7ed9UI\u7ec4\u4ef6props\u7684value\n */\nconst mapDispatchToProps = dispatch => {\n  // \u901a\u77e5redux\u6267\u884c\n  return {\n    addTodoAction: todoObj => dispatch(addTodoAction(todoObj)),\n    deleteTodo: id => dispatch(deleteTodo(id)),\n    countAdd: number => dispatch(countAdd(number)),\n    countAddAsync: (number, delay) => dispatch(countAddAsync(number, delay)),\n  };\n};\n\n/**\n * \u4f7f\u7528connect()()  \u521b\u5efa\u66b4\u9732    \u5efa\u7acb\u8fde\u63a5   connect \u5f62\u6210 \u7236\u5b50\u7ec4\u4ef6\u5173\u7cfb\n * connect \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e24\u4e2a\u51fd\u6570  \u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f5c\u4e3a\u72b6\u6001\u4f20\u9012\u7ed9\u4e86UI\u7ec4\u4ef6\n */\nexport default connect(mapStateToProps, mapDispatchToProps)(List);\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"Item/index.jsx"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"constant.js"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"action.js"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"reducers.js"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"store.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { createStore, combineReducers, applyMiddleware } from 'redux';\nimport { todoReducer, count } from './reducers';\n// \u5f15\u5165redux-thunk \u7528\u4e8e\u652f\u6301\u5f02\u6b65action\nimport thunk from 'redux-thunk';\n\nconst allReducers = combineReducers({ todossss: todoReducer, count });\n\nexport default createStore(allReducers, applyMiddleware(thunk));\n")),(0,a.kt)("h4",{id:"hook"},"Hook"))}l.isMDXComponent=!0}}]);