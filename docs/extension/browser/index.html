<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="HonjayChang Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="HonjayChang Blog Atom Feed"><title data-react-helmet="true">浏览器相关 | HonjayChang</title><meta data-react-helmet="true" property="og:url" content="https://honjaychang.github.io//docs/extension/browser"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="浏览器相关 | HonjayChang"><meta data-react-helmet="true" name="description" content="浏览器输入网址到页面渲染全过程"><meta data-react-helmet="true" property="og:description" content="浏览器输入网址到页面渲染全过程"><link data-react-helmet="true" rel="shortcut icon" href="/img/photo.ico"><link data-react-helmet="true" rel="canonical" href="https://honjaychang.github.io//docs/extension/browser"><link data-react-helmet="true" rel="alternate" href="https://honjaychang.github.io//docs/extension/browser" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://honjaychang.github.io//docs/extension/browser" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6b743985.css">
<link rel="preload" href="/assets/js/runtime~main.5c976dc7.js" as="script">
<link rel="preload" href="/assets/js/main.a852bf25.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://honjaychang.github.io/docs/home" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/img/photo.jpg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/photo.jpg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/Home">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Honjaychang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Home">Home</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HC</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JS</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Extension</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extension/web-api">Web-API</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/extension/browser">浏览器相关</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extension/network">计网</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">TS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ReactCore</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Dev</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Algo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Interview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Vue</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">浏览器相关</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="浏览器输入网址到页面渲染全过程"></a>浏览器输入网址到页面渲染全过程<a class="hash-link" href="#浏览器输入网址到页面渲染全过程" title="Direct link to heading">#</a></h2><ul><li><p>DNS 解析：域名解析为 IP 地址</p></li><li><p>TCP 连接：三次握手</p></li><li><p>发送 HTTP 请求</p></li><li><p>服务器处理请求 并 返回 HTTP 响应报文</p></li><li><p>浏览器解析渲染页面：<code>HTML、CSS、JS</code>文件</p></li><li><p><code>DOM Tree + CSSOM =&gt; Render Tree =&gt; JS =&gt; Render Tree</code></p></li><li><p>连接结束：四次挥手</p></li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://segmentfault.com/a/1190000006879700" target="_blank" rel="noopener noreferrer">前端经典面试题: 从输入 URL 到页面加载发生了什么？</a></li><li><a href="https://blog.fundebug.com/2019/02/28/what-happens-from-url-to-webpage/" target="_blank" rel="noopener noreferrer">经典面试题：从 URL 输入到页面展现到底发生什么？</a></li><li><a href="https://www.cnblogs.com/xrq730/p/4931418.html" target="_blank" rel="noopener noreferrer">五月的仓颉 DNS域名解析过程</a></li></ul><p>isboyjc</p><ul><li><a href="https://juejin.cn/post/6844904132071915527" target="_blank" rel="noopener noreferrer">「一道面试题」输入URL到渲染全面梳理上-网络通信篇</a></li><li><a href="https://juejin.cn/post/6844904134307495943" target="_blank" rel="noopener noreferrer">「一道面试题」输入URL到渲染全面梳理中-页面渲染篇</a></li><li><a href="https://juejin.cn/post/6844904155077672968" target="_blank" rel="noopener noreferrer">「一道面试题」输入URL到渲染全面梳理下-总结篇</a></li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="页面渲染"></a>页面渲染<a class="hash-link" href="#页面渲染" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://wangdoc.com/javascript/bom/engine.html" target="_blank" rel="noopener noreferrer">浏览器环境概述</a></li><li><a href="https://segmentfault.com/a/1190000018130499" target="_blank" rel="noopener noreferrer">css 加载会造成阻塞吗</a></li><li><a href="https://juejin.cn/post/6844903661139656718" target="_blank" rel="noopener noreferrer">JS脚本异步加载浅析</a></li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="渲染进程"></a>渲染进程<a class="hash-link" href="#渲染进程" title="Direct link to heading">#</a></h3><ul><li>即通常所说的浏览器内核(<code>Renderer</code>进程，内部是多线程)</li><li>每个Tab页面都有一个渲染进程，互不影响</li><li>主要作用为页面渲染，脚本执行，事件处理等</li></ul><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211024104939.png" alt="image-20211024104939801"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="渲染流程"></a>渲染流程<a class="hash-link" href="#渲染流程" title="Direct link to heading">#</a></h3><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/webkitflow.png" alt="Webkit渲染流程图"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="解析html构建dom树"></a>解析HTML构建DOM树<a class="hash-link" href="#解析html构建dom树" title="Direct link to heading">#</a></h3><ul><li>根据 <code>HTML</code> 代码生成 <code>DOM Tree</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字节</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Characters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字符</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Tokens</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">词</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Nodes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">节点</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DOM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DOM树</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="解析css构建cssom树"></a>解析CSS构建CSSOM树<a class="hash-link" href="#解析css构建cssom树" title="Direct link to heading">#</a></h3><ul><li>根据 <code>CSS</code> 代码生成 <code>CSSOM</code><ul><li><code>css</code> 不会阻塞<code>DOM</code>树的解析</li><li><code>css</code> 加载会阻塞<code>DOM</code>树渲染</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字节</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Characters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字符</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Tokens</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">词</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Nodes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">节点</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> CSSOM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CSSOM树</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="解析js脚本"></a>解析JS脚本<a class="hash-link" href="#解析js脚本" title="Direct link to heading">#</a></h3><ul><li>遇到正常 <code>&lt;script&gt;</code> 则暂停渲染，优先加载并执行<code>JS</code>代码，完成再继续</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="async"></a><code>async</code><a class="hash-link" href="#async" title="Direct link to heading">#</a></h4><ul><li><code>&lt;script src=&quot;a.js&quot; async&gt;&lt;/script&gt;</code></li><li>异步执行，并行下载，下载过程不阻碍HTML解析</li><li>下载完成，立即执行。会 <strong>暂停 HTML 解析</strong></li><li><code>async</code> 不确保执行顺序，优先执行先下载完成的。一定在 <code>onload</code> 前，但不确定在 <code>DOMContentLoaded</code> 事件的前或后</li><li>当同时存在<code>defer async</code>的时候 <code>defer</code>将会失效</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defer"></a><code>defer</code><a class="hash-link" href="#defer" title="Direct link to heading">#</a></h4><ul><li><code>&lt;script src=&quot;a.js&quot; defer&gt;&lt;/script&gt;</code></li><li>延迟执行，并行下载，下载过程不阻碍HTML解析</li><li>等到 DOM 加载生成后，再执行脚本（即触发 <code>DOMContentLoaded</code> 事件前执行</li></ul><blockquote><p><a href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" target="_blank" rel="noopener noreferrer">图源</a></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="image-20211013215208374构建渲染树"></a><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211013215208.png" alt="image-20211013215208374">构建渲染树<a class="hash-link" href="#image-20211013215208374构建渲染树" title="Direct link to heading">#</a></h3><p>渲染树 <code>Render Tree</code> 由 <code>DOM树</code>、<code>CSSOM树</code> 合并而成，并且无先后条件，会有所交叉，并行构建。因此会形成一边加载，一边解析，一边渲染的工作现象</p><ul><li>浏览器首先会从DOM树的根节点开始遍历每个<strong>可见节点</strong></li><li>对于每个可见节点，找到其对应的的 CSSOM 规则并应用它们</li><li>输出可见节点，连同其内容和计算的样式</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="布局"></a>布局<a class="hash-link" href="#布局" title="Direct link to heading">#</a></h3><p>计算它们在设备 视口 内的确切位置和大小</p><p>此阶段如果元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="绘制"></a>绘制<a class="hash-link" href="#绘制" title="Direct link to heading">#</a></h3><p>经由前几步我们知道了哪些节点可见、它们的计算样式以及几何信息，我们将这些信息传递给最后一个阶段将渲染树中的每个节点转换成屏幕上的实际像素，也就是俗称的 <code>绘制</code> 或 <code>栅格化</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="回流-重绘"></a>回流 重绘<a class="hash-link" href="#回流-重绘" title="Direct link to heading">#</a></h4><ul><li>回流<code>reflow</code>：<code>render</code>树中一部分或全部元素需要改变尺寸、布局、或着需要隐藏而需要重新构建</li><li>重绘<code>repaint</code>：<code>render</code>树中一部分元素改变，而不影响布局的，只影响外观的，比如颜色</li><li>回流必将引起重绘</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="合成"></a>合成<a class="hash-link" href="#合成" title="Direct link to heading">#</a></h3><p>图成的概念 未深入</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h3><ul><li>调用 <code>GUI</code> 渲染线程 解析 <code>HTML CSS </code></li><li>调用 <code>JS</code> 引擎 解析 <code>JS</code></li></ul><ul><li>解析代码：解析 <code>HTML</code> 构建 <code>DOM</code> 树 解析 <code>CSS</code> 构建 <code>CSSOM</code> 树<ul><li>解析过程中碰到 <code>js</code> 代码会停止解析去请求</li></ul></li><li>对象合成：根据 <code>DOM CSSOM</code> 生成 <code>Render Tree</code></li><li>布局：计算出 <code>Render Tree</code> 的布局</li><li>绘制：将 <code>Render Tree</code> 绘制到屏幕</li></ul><ul><li><code>CSS</code> 的加载与解析不会阻塞 <code>HTML</code> 的解析，他们是并行的。<ul><li>但会阻塞渲染树 <code>RenderTree</code> 的生成，也会阻塞界面的渲染！</li></ul></li><li><code>CSS</code> 不会阻塞 <code>DOM</code> 的解析，但会阻塞 <code>DOM</code> 渲染。</li><li><code>JS</code> 会阻塞 <code>DOM</code> 的解析和渲染<ul><li>浏览器需要等<code>css|js</code>都解析完成之后才会执行渲染</li></ul></li><li>媒体资源 (如:图片音视频等) 的加载不会阻塞HTML的解析 所以他们可以并行加载</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="渲染优化"></a>渲染优化<a class="hash-link" href="#渲染优化" title="Direct link to heading">#</a></h3><blockquote><p>为什么要将 <code>CSS &lt;link href=&quot;#&quot;&gt;</code> 放在 head 中</p></blockquote><ul><li>在<code>DOM</code>树生成前就将<code>CSS</code>规则加载完</li><li>在<code>DOM</code>生成完成后直接和所有的<code>CSS</code>规则整合 =&gt; 一步渲染完成 <code>Render Tree</code></li></ul><blockquote><p>为何建议将<code>JS</code>放在<code>body</code>最后</p></blockquote><ul><li>不放在最后的话，<code>JS</code> 代码会阻塞 <code>render tree</code> 的渲染，可能会导致页面渲染时间比较长</li></ul><blockquote><p><code>window.onload</code> 和 <code>DOMContentLoaded</code>的区别</p></blockquote><ul><li>建议使用<code>document.addEventListener(&#x27;DOMContentLoaded&#x27;, callback)</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;load&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 页面的全部资源加载完成后才会执行，包括图片、视频等</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;DOMContentLoaded&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// DOM 渲染完成即可执行，此时图片、视频可能还没有加载完</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>优化方案</p></blockquote><ul><li>缓存 DOM 操作 多次 DOM 变成插入一个<code>createDocumentFragment</code></li><li>使用<code>window.requestAnimationFrame()</code>，因为它可以把代码推迟到下一次重绘之前执行，而不是立即要求页面重绘。</li><li>使用虚拟 DOM</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="raf"></a>RAF<a class="hash-link" href="#raf" title="Direct link to heading">#</a></h5><ul><li><p><strong><code>window.requestAnimationFrame()</code></strong> 告诉浏览器：你希望执行一个动画，并且要求浏览器在下次重绘之前调用指定的回调函数更新动画。</p></li><li><p>要想动画流畅，更新频率要 60 帧/s，即 16.67ms 更新一次视图</p></li><li><p><code>setTimeout</code> 要手动控制频率，而 RAF 浏览器会自动控制</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">后台标签或者隐藏在iframe中， </span><span class="token constant" style="color:#36acaa">RAF</span><span class="token plain"> 会暂停，而setTimeout 依然执行</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3s 把宽度 从100px -&gt; 640px 增加 540px</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 60帧/s 3s 180帧 每次变化 3px</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 而且当页面切换的时候会暂停执行</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> div1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;div1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> curWidth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> maxWidth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">640</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// setTimeout</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">animate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  curWidth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> curWidth </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  div1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> curWidth </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;px&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">curWidth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> div1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">curWidth </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxWidth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">animate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16.7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这里的animate 没加括号</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// RAF</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">animate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  curWidth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> curWidth </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  div1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> curWidth </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;px&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">curWidth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> div1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">curWidth </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxWidth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">requestAnimationFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">animate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 时间不用自己控制</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">animate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="性能优化"></a>性能优化<a class="hash-link" href="#性能优化" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://juejin.cn/post/6844904031240863758" target="_blank" rel="noopener noreferrer">2020 年了,再不会 webpack 敲得代码就不香了(近万字实战)</a></li><li><a href="https://juejin.cn/post/6854573213171580941" target="_blank" rel="noopener noreferrer">你可能不知道的 9 条 Webpack 优化策略</a></li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="性能优化原则"></a>性能优化原则<a class="hash-link" href="#性能优化原则" title="Direct link to heading">#</a></h3><ul><li>多使用内存、缓存或其他方法</li><li>减少 CPU 计算量，减少网络请求，减少网络加载耗时</li><li>空间换时间</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="从何入手"></a>从何入手<a class="hash-link" href="#从何入手" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="让加载更快"></a>让加载更快<a class="hash-link" href="#让加载更快" title="Direct link to heading">#</a></h5><ul><li>减少资源体积：压缩代码</li><li>减少访问次数：合并代码，SSR 服务器端渲染，缓存</li><li>使用更快的网络： CDN</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="让渲染更快"></a>让渲染更快<a class="hash-link" href="#让渲染更快" title="Direct link to heading">#</a></h5><ul><li><code>CSS</code> 放在<code>head</code> ，<code>JS</code>放在<code>body</code>最下面</li><li>尽早开始执行<code>JS</code>，用<code>DOMContentLoaded</code></li><li>触发懒加载（图片懒加载，上滑加载更多）</li><li>对 DOM 查询进行缓存</li><li>频繁 DOM 操作，合并到一起插入 DOM 结构</li><li>节流<code>throttle</code>防抖<code>debounce</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="实例"></a>实例<a class="hash-link" href="#实例" title="Direct link to heading">#</a></h4><ul><li><p>资源合并 ==&gt; 请求三次 3kb 和请求一次 9kb 3 次网络请求--&gt; 1 次</p></li><li><p>缓存 ==&gt; webpack 生成的<code>bundle.[contenthash].js </code></p><ul><li>如果生成的内容没有发生变化即哈希值没有发生改变 则不需要重新进行请求</li><li>静态资源加<code>hash</code>后缀，根据文件内容计算<code>hash</code>。如果文件内容不变，则<code>hash</code>不变，则<code>url</code>不变。既然 url 和文件不变，则会自动触发 HTTP 缓存机制，返回 304</li></ul></li><li><p><code>CDN</code> ==&gt; 根据地域做网络服务。静态文件 满足 304 机制</p></li><li><p><code>SSR</code> ==&gt; 服务器端渲染：网页和数据一起加载，一起渲染</p></li><li><p>非 <code>SSR</code> ==&gt; （前后端分离）：先加载网页，再加载数据，再渲染数据 (早先的<code>JSP ASP PHP</code> ，现在的<code>vue React </code></p></li><li><p>懒加载</p><ul><li>加载<code>loading</code>图片</li><li>判断哪些图片要加载</li><li>隐形加载图片</li><li>替换真图片</li></ul></li></ul><p>一张图片就是一个<code>&lt;img&gt;</code>标签，浏览器是否发起请求图片是根据<code>&lt;img&gt;</code>的<code>src</code>属性，所以实现懒加载的关键就是，在图片没有进入可视区域时，先不给<code>&lt;img&gt;</code>的<code>src</code>赋值，这样浏览器就不会发送请求了，等到图片进入可视区域再给<code>src</code>赋值</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 可以给img标签统-自定义属性data=src=&#x27;default.png&#x27;，当检测到图片出现在窗口之后再补充src属性，此时才会进行图片资源加载</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazyload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> imgs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;img&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 视口高度</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> viewHeight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">documentElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clientHeight</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//滚动务高度</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> scrollHeight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">documentElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">scrolltop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">scrollTop</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> offsetHeight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imgs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetTop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">offsetHeight </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> viewHeight </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> scrollHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> src </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imgs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dataset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      imgs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//可以使用节流优化一下</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventlListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;scroll&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lazyload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://blog.csdn.net/w1418899532/article/details/90515969" target="_blank" rel="noopener noreferrer">js 实现图片懒加载原理</a></li></ul></div></div><ul><li>缓存 DOM 查询</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 不缓存 DOM 查询结果</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;p&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 每次循环 都会计算length 频繁进行DOM查询</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 缓存 DOM 查询结果</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;p&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> length </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 缓存length 只进行一次 DOM 查询</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>多个 DOM 操作一起插入到 DOM 结构：<ul><li><code>document.createDocumentFragment()</code></li></ul></li><li>尽早开始<code>JS</code>执行</li><li><code>document.addEventListener(&#x27;DOMContentLoaded&#x27;, function () {}</code></li><li>防抖节流</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="首屏优化"></a>首屏优化<a class="hash-link" href="#首屏优化" title="Direct link to heading">#</a></h3><ul><li>尽可能的缩小 webpack 或者其他打包工具生成的包的大小</li><li>路由懒加载</li><li>组件按需加载</li><li>图片懒加载</li><li>服务端渲染 SSR</li><li>gzip</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="csr-ssr"></a>CSR SSR<a class="hash-link" href="#csr-ssr" title="Direct link to heading">#</a></h4><ul><li><code>CSR</code> 客户端渲染</li><li><code>SSR</code> 服务端渲染<ul><li>由服务端把渲染的完整的页面返回给客户端，减少了一次客户端到服务端的一次 http 请求</li><li>返回完整页面 就利于 SEO 优化</li><li>SSR 强在首屏渲染。而 CSR 强在用户和页面多交互的场景</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="存储"></a>存储<a class="hash-link" href="#存储" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://www.kancloud.cn/kancloud/http-cookies-explained/48333" target="_blank" rel="noopener noreferrer">HTTP cookies 详解</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/157" target="_blank" rel="noopener noreferrer">浏览器系列之 Cookie 和 SameSite 属性</a></li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cookie"></a><code>cookie</code><a class="hash-link" href="#cookie" title="Direct link to heading">#</a></h3><blockquote><p>如何设置<code>cookie</code> </p></blockquote><ul><li><p>客户端发送 HTTP 请求到服务器</p></li><li><p>当服务器收到 HTTP 请求时，在响应头里面添加一个 <code>Set-Cookie</code> 字段</p></li><li><p>浏览器收到响应后保存下 <code>Cookie</code></p></li><li><p>之后对该服务器每一次请求中都通过 <code>Cookie</code> 字段将 <code>Cookie</code> 信息发送给服务器</p></li><li><p><code>cookie</code>的编码方式：<code>encodeURI()</code></p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="属性"></a>属性<a class="hash-link" href="#属性" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Expires=&lt;date&gt;; Max-Age=&lt;non-zero-digit&gt;; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">Domain=&lt;domain-value&gt;; Path=&lt;path-value&gt;; Secure; HttpOnly; SameSite=Strict</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>name</code>:  <code>key-value</code> 键值对</li><li><code>Expires</code>: <code>cookie</code> 的最长有效时间<ul><li>会话性 <code>cookie</code>: <code>Expires</code> 属性缺省时，值保存在客户端内存中，并在用户关闭浏览器时失效</li><li>持久性 <code>cookie</code>，保存在用户的硬盘中，直至过期或者清除 <code>Cookie</code></li></ul></li><li><code>Max-Age</code>: <code>cookie</code> 生成后失效的秒数<ul><li><code>Expires</code> 和 <code>Max-Age</code> 都存在，<code>Max-Age</code> 优先级更高</li></ul></li><li><code>Domain</code>: 指定了 <code>cookie</code> 可以送达的主机名<ul><li>如淘宝设置 <code>Domain = .taobao.com</code>，这样无论是 <code>a.taobao.com</code> 还是 <code>b.taobao.com</code> 都可以使用 <code>cookie</code></li></ul></li></ul><blockquote><p>通过设置<code>document.domain</code>使得二级域名共享<code>cookie</code> 解决跨域问题</p></blockquote><ul><li><code>Path</code>: 可以限制当前<code>cookie</code>只属于某个路径下<ul><li><code>Domain</code> 和 <code>Path</code> 标识共同定义了 <code>cookie</code> 的作用域：即 <code>cookie</code> 应该发送给哪些 URL</li></ul></li><li><code>Secure</code>：只允许在 <code>https</code> 下传输 以免被 窃取 或 篡改</li><li><code>HttpOnly</code>: 使得不能被客户端更改访问，无法通过<code>js</code>脚本读取到该<code>cookie</code>的信息。但还是能通过 <code>Application</code>中手动修改<code>cookie</code>，所以只是在一定程度上可以防止<code>xss</code>攻击，并不是绝对的安全</li><li><code>SameSite</code>: 让 <code>cookie</code> 在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击<code>CSRF</code><ul><li><code>Strict</code>: 浏览器将只发送相同站点请求的 <code>cookie</code> 完全一致才可以</li><li><code>Lax</code>: 允许部分第三方请求携带 <code>cookie</code></li><li><code>None</code>: 无论是否 <strong>跨站</strong> 都会发送 <code>cookie</code></li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="作用"></a>作用<a class="hash-link" href="#作用" title="Direct link to heading">#</a></h4><ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li><li>个性化设置（如用户自定义设置、主题等）</li><li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="缺点"></a>缺点<a class="hash-link" href="#缺点" title="Direct link to heading">#</a></h4><p>可以从大小、安全、增加请求大小等方面回答</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="三者区别"></a>三者区别<a class="hash-link" href="#三者区别" title="Direct link to heading">#</a></h3><ul><li>容量</li><li>API 易用性</li><li>是否跟随<code>http</code>请求发送出去</li></ul><blockquote><p>比较<code>cookie、localStorage、sessionStorage</code></p></blockquote><p>相同点：都是存储数据，存储在 web 端，并且都是同源</p><p>不同点：</p><ul><li><code>cookie</code> 只有 4K 并且每一次 http 请求都会带上<code>cookie</code> ，增加请求数据量，浪费带宽</li><li><code>sessionStorage</code>和<code>localStorage</code>直接存储在本地，请求不会携带，并且容量比<code>cookie</code>要大的多（5M？）</li><li>生命周期：<ul><li><code>sessionStorage</code> 是临时会话，当前窗口被关闭的时候就清除掉</li><li><code>localStorage</code> 永久存在，除非手动删除或用代码删除，一般用<code>localStorage</code> 会更多一些</li><li><code>cookie</code> 有过期时间</li></ul></li><li><code>cookie</code> 和<code>localStorage</code>都可以支持多窗口共享(同源策略)，而<code>session</code>不支持多窗口共享。但是都支持 a 链接跳转的新窗口</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api"></a>API<a class="hash-link" href="#api" title="Direct link to heading">#</a></h4><ul><li><p><code>cookie:</code> 可用<code>document.cookie = &#x27;...&#x27;</code>来修改，但一次只能赋值一个且同一个 key 会覆盖，不同的 key 是追加的过程。</p></li><li><p><code>localStorage sessionStorage:</code> API 简易使用<code>setItem getItem</code></p></li><li><p><code>setItem(key, value)</code>设置存储内容</p></li><li><p><code>getItem(key)</code>读取存储内容</p></li><li><p><code>removeItem(key)</code>删除键值为<code>key</code>的存储内容</p></li><li><p><code>clear()</code>清空所有存储内容</p></li><li><p><code>key(n)</code> 以索引值来获取键名</p></li><li><p><code>length</code>存储的数据的个数</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="indexdb"></a><code>IndexDB</code><a class="hash-link" href="#indexdb" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="http-缓存策略"></a>HTTP 缓存策略<a class="hash-link" href="#http-缓存策略" title="Direct link to heading">#</a></h2><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211022223403.png" alt="image-20211004094906556"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="浏览器的三级缓存"></a>浏览器的三级缓存<a class="hash-link" href="#浏览器的三级缓存" title="Direct link to heading">#</a></h4><ul><li>内存 =&gt; 磁盘 =&gt; 网络请求</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="强制缓存"></a>强制缓存<a class="hash-link" href="#强制缓存" title="Direct link to heading">#</a></h4><ul><li><p>在过期时间内，未被主动清除 都不会请求服务器 而使用强制缓存 =&gt; 协商缓存</p></li><li><p><code>200 from disk cache</code> <code>200 from memory cache</code></p></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cache-control"></a><code>cache-control</code><a class="hash-link" href="#cache-control" title="Direct link to heading">#</a></h5><ul><li><code>max-age</code>：浏览器可以接收生存期不大于指定时间（秒）的响应</li><li><code>no-cache</code>：不用强制缓存，让服务端缓存</li><li><code>no-store</code>：不用强制缓存，也不让服务端缓存</li><li><code>private</code>：允许终端用户</li><li><code>public</code>：允许中间代理</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="expires"></a><code>Expires</code><a class="hash-link" href="#expires" title="Direct link to heading">#</a></h5><ul><li>同为控制缓存过期。如果 <code>cache-control</code> 与 <code>expires</code> 同时存在的话，<code>cache-control</code> 的优先级高于<code>expires</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="协商缓存对比缓存"></a>协商缓存（对比缓存）<a class="hash-link" href="#协商缓存对比缓存" title="Direct link to heading">#</a></h4><ul><li>浏览器和服务器协商，每次都需要和服务器通信</li><li>第一次请求时，服务器会返回资源和一个资源的缓存标识</li><li>第二次请求时，浏览器会先将缓存标识发给服务器 然后服务器对标识进行匹配<ul><li>不匹配 =&gt; 资源有更新 =&gt; 服务器返回新资源和新的缓存标识</li><li>匹配 =&gt; 资源未更改 =&gt; 返回 304 状态码 读取本地浏览器缓存</li></ul></li></ul><blockquote><p><code>200 from cache</code> <code>304 Not Modified</code></p></blockquote><ul><li><code>200 OK from cache</code> 不向服务器发送请求，直接使用本地缓存文件</li><li><code>304 Not Modified</code> 则向服务器询问，若服务器认为浏览器的缓存版本还可用，那么便会返回304</li></ul><blockquote><p>服务端如何判断缓存失效</p></blockquote><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="last-modified"></a><code>Last-Modified</code><a class="hash-link" href="#last-modified" title="Direct link to heading">#</a></h5><ul><li><code>Last-Modified</code> 响应资源的最后修改时间	对应 <code>If-Modified-Since</code></li><li>只能精确到秒级		配合 <code>cache-control</code> 使用</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="etag"></a><code>Etag</code><a class="hash-link" href="#etag" title="Direct link to heading">#</a></h5><ul><li><code>Etag</code>是服务器响应请求时，返回当前资源文件的一个唯一标识(类似指纹 由服务器生成)		对应 <code>If-None-Match</code></li><li>同时存在 会优先使用 <code>Etag</code></li></ul><p>主要解决<code>Last-Modified</code> 存在的问题</p><ul><li><code>Last-Modified</code> 只能精确到秒级，如果1秒内被多次修改无法获取精确时间</li><li>文件定期生成，但文件内容不变，会导致<code>Last-Modified</code>变化，而无法使用缓存  此时使用 <code>Etag</code> 会更合适</li><li>服务器时间不一致的情况</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="浏览器加载js文件有缓存"></a>浏览器加载<code>JS</code>文件有缓存<a class="hash-link" href="#浏览器加载js文件有缓存" title="Direct link to heading">#</a></h5><ul><li>浏览器加载 js 文件是根据路径加载，首先根据路径在缓存里查找</li><li>解决办法：打包时加一些哈希值 or 版本号</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ref</h5></div><div class="admonition-content"><ul><li><a href="https://blog.csdn.net/i13738612458/article/details/80383390?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control" target="_blank" rel="noopener noreferrer">js 浏览器缓存机制</a></li><li><a href="https://blog.csdn.net/feiyu_may/article/details/88376945" target="_blank" rel="noopener noreferrer">浏览器缓存带来的前端项目更新问题及解决方法</a></li></ul></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="刷新操作对缓存的影响"></a>刷新操作对缓存的影响<a class="hash-link" href="#刷新操作对缓存的影响" title="Direct link to heading">#</a></h5><ul><li>正常操作:<ul><li>地址栏输入<code>url</code>，跳转链接，前进后退等</li><li>强制缓存有效，协商缓存有效</li></ul></li><li>手动刷新:<ul><li><code>F5</code>，点击刷新按钮，右击菜单刷新</li><li>强制缓存失效，协商缓存有效</li></ul></li><li>强制刷新:<ul><li><code>ctrl + F5</code></li><li>强制缓存失效，协商缓存失效</li></ul></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="不能被缓存的请求"></a>不能被缓存的请求<a class="hash-link" href="#不能被缓存的请求" title="Direct link to heading">#</a></h5><ul><li>HTTP信息头中包含<code>Cache-Control:no-cache | max-age = 0</code>，等告诉浏览器不用缓存的请求</li><li>需要根据<code>Cookie</code>，认证信息等决定输入内容的动态请求是不能被缓存的</li><li>经过<code>HTTPS</code>安全加密的请求</li><li>POST请求无法被缓存</li><li>HTTP响应头中不包含<code>Last-Modified/Etag</code>，也不包含<code>Cache-Control/Expires</code>的请求无法被缓存</li></ul><h2></h2></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/extension/web-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Web-API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extension/network"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">计网 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#浏览器输入网址到页面渲染全过程" class="table-of-contents__link">浏览器输入网址到页面渲染全过程</a></li><li><a href="#页面渲染" class="table-of-contents__link">页面渲染</a><ul><li><a href="#渲染进程" class="table-of-contents__link">渲染进程</a></li><li><a href="#渲染流程" class="table-of-contents__link">渲染流程</a></li><li><a href="#解析html构建dom树" class="table-of-contents__link">解析HTML构建DOM树</a></li><li><a href="#解析css构建cssom树" class="table-of-contents__link">解析CSS构建CSSOM树</a></li><li><a href="#解析js脚本" class="table-of-contents__link">解析JS脚本</a></li><li><a href="#image-20211013215208374构建渲染树" class="table-of-contents__link">image-20211013215208374构建渲染树</a></li><li><a href="#布局" class="table-of-contents__link">布局</a></li><li><a href="#绘制" class="table-of-contents__link">绘制</a></li><li><a href="#合成" class="table-of-contents__link">合成</a></li><li><a href="#总结" class="table-of-contents__link">总结</a></li><li><a href="#渲染优化" class="table-of-contents__link">渲染优化</a></li></ul></li><li><a href="#性能优化" class="table-of-contents__link">性能优化</a><ul><li><a href="#性能优化原则" class="table-of-contents__link">性能优化原则</a></li><li><a href="#首屏优化" class="table-of-contents__link">首屏优化</a></li></ul></li><li><a href="#存储" class="table-of-contents__link">存储</a><ul><li><a href="#cookie" class="table-of-contents__link"><code>cookie</code></a></li><li><a href="#三者区别" class="table-of-contents__link">三者区别</a></li><li><a href="#indexdb" class="table-of-contents__link"><code>IndexDB</code></a></li></ul></li><li><a href="#http-缓存策略" class="table-of-contents__link">HTTP 缓存策略</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.5c976dc7.js"></script>
<script src="/assets/js/main.a852bf25.js"></script>
</body>
</html>