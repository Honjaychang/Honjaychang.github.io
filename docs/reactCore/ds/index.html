<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="HonjayChang Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="HonjayChang Blog Atom Feed"><title data-react-helmet="true">æ•°æ®ç»“æ„å®šä¹‰ | HonjayChang</title><meta data-react-helmet="true" property="og:url" content="https://honjaychang.github.io//docs/reactCore/ds"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="æ•°æ®ç»“æ„å®šä¹‰ | HonjayChang"><meta data-react-helmet="true" name="description" content="Reactå…ƒç´ "><meta data-react-helmet="true" property="og:description" content="Reactå…ƒç´ "><link data-react-helmet="true" rel="shortcut icon" href="/img/photo.ico"><link data-react-helmet="true" rel="canonical" href="https://honjaychang.github.io//docs/reactCore/ds"><link data-react-helmet="true" rel="alternate" href="https://honjaychang.github.io//docs/reactCore/ds" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://honjaychang.github.io//docs/reactCore/ds" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6b743985.css">
<link rel="preload" href="/assets/js/runtime~main.b087496d.js" as="script">
<link rel="preload" href="/assets/js/main.9cb9d5d7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://honjaychang.github.io/docs/home" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/img/photo.jpg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/photo.jpg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/Home">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Honjaychang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Home">Home</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HC</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Extension</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">TS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">ReactCore</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactCore/basic">ä¸€äº›æ¦‚å¿µ</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/reactCore/ds">æ•°æ®ç»“æ„å®šä¹‰</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactCore/createUpdate">æ›´æ–°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactCore/schedule">ä»»åŠ¡è°ƒåº¦</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactCore/render">renderé˜¶æ®µ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactCore/diff">diff</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Dev</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Network</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Algo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Interview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Vue</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">æ•°æ®ç»“æ„å®šä¹‰</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reactå…ƒç´ "></a>Reactå…ƒç´ <a class="hash-link" href="#reactå…ƒç´ " title="Direct link to heading">#</a></h2><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211002133506.png" alt="image-20211002133506599"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="jsx"></a><code>JSX</code><a class="hash-link" href="#jsx" title="Direct link to heading">#</a></h3><p><code>JSX</code> æ˜¯ä¸€ä¸ª <code>JavaScript</code> çš„è¯­æ³•æ‰©å±•ï¼Œå¯ä»¥å¾ˆå¥½åœ°æè¿° <code>UI</code> åº”è¯¥å‘ˆç°å‡ºå®ƒåº”æœ‰äº¤äº’çš„æœ¬è´¨å½¢å¼</p><p><code>JSX</code> åœ¨ç¼–è¯‘æ—¶ä¼šè¢« <code>Babel</code> è½¬è¯‘ä¸º <code>React.createElement()</code> å‡½æ•°è°ƒç”¨æ¥ç”Ÿæˆ <code>React element</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1 className</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;greeting&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> world</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;h1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">className</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;greeting&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Hello, world!&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–è¿‡çš„ç»“æ„</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;h1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    className</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;greeting&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Hello, world!&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reactcreateelement"></a><code>React.createElement</code><a class="hash-link" href="#reactcreateelement" title="Direct link to heading">#</a></h3><ul><li><code>React.createElement()</code>æœ€ç»ˆä¼šè°ƒç”¨<code>ReactElement()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ç»„ä»¶æ•°æ®çš„å¯¹è±¡<ul><li>è¯¥å¯¹è±¡æœ‰ä¸ªå‚æ•°<code>$$typeof: REACT_ELEMENT_TYPE</code>æ ‡è®°äº†è¯¥å¯¹è±¡æ˜¯ä¸ª<code>React Element</code></li><li>æ‰€ä»¥è°ƒç”¨<code>React.createElement</code>è¿”å›çš„å¯¹è±¡å°±æ˜¯<code>React Element</code></li></ul></li></ul><p>è¿™äº›å¯¹è±¡è¢«ç§°ä¸º <code>React å…ƒç´ </code>ã€‚å®ƒä»¬æè¿°äº†ä½ å¸Œæœ›åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å†…å®¹ã€‚React é€šè¿‡è¯»å–è¿™äº›å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å®ƒä»¬æ¥æ„å»º DOM ä»¥åŠä¿æŒéšæ—¶æ›´æ–°ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">type</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> config</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> children</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ......</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">ReactElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">ReactCurrentOwner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">ReactElement</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">type</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> key</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> ref</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> self</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> source</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> owner</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// This tag allows us to uniquely identify this as a React Element</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ ‡è®°è¿™æ˜¯ä¸ª React Element</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    $$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">REACT_ELEMENT_TYPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Built-in properties that belong on the element</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// åŸç”ŸDOM p div å±äº HostComponent æŒ‡å‘äº†ç»„ä»¶çš„æ„é€ å‡½æ•°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ref</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Record the component responsible for creating this element.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> owner</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ä½†æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼šReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">createPortalçš„æ—¶å€™æ˜¯</span><span class="token constant" style="color:#36acaa">REACT_PORTAL_TYPE</span><span class="token plain">ï¼Œä¸è¿‡ä»–ä¸æ˜¯é€šè¿‡createElementåˆ›å»ºçš„ï¼Œæ‰€ä»¥ä»–åº”è¯¥ä¹Ÿä¸å±äºReactElement</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸æµè§ˆå™¨çš„ DOM å…ƒç´ ä¸åŒï¼ŒReact å…ƒç´ æ˜¯åˆ›å»ºå¼€é”€æå°çš„æ™®é€šå¯¹è±¡ã€‚React DOM ä¼šè´Ÿè´£æ›´æ–° DOM æ¥ä¸ React å…ƒç´ ä¿æŒä¸€è‡´ã€‚</p><p>æƒ³è¦å°†ä¸€ä¸ª React å…ƒç´ æ¸²æŸ“åˆ°æ ¹ DOM èŠ‚ç‚¹ä¸­ï¼Œåªéœ€æŠŠå®ƒä»¬ä¸€èµ·ä¼ å…¥ <code>ReactDOM.render()</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> world</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;root&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="react-element"></a><code>React element</code><a class="hash-link" href="#react-element" title="Direct link to heading">#</a></h3><ul><li>Reactç»„ä»¶å…ƒç´ </li><li>å®¿ä¸»ç»„ä»¶å…ƒç´ -HostComponentï¼ˆdivã€span</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="react-component"></a><code>react Component</code><a class="hash-link" href="#react-component" title="Direct link to heading">#</a></h3><p><code>ClassComponent</code>å¯¹åº”çš„<code>Element</code>çš„<code>type</code>å­—æ®µä¸º<code>AppClass</code>è‡ªèº«ã€‚</p><p><code>FunctionComponent</code>å¯¹åº”çš„<code>Element</code>çš„<code>type</code>å­—æ®µä¸º<code>AppFunc</code>è‡ªèº«</p><p>æ— æ³•é€šè¿‡å¼•ç”¨ç±»å‹åŒºåˆ†<code>ClassComponent</code>å’Œ<code>FunctionComponent</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">AppClass</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">AppFunc</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¯ä»¥<code>React</code>é€šè¿‡<code>ClassComponent</code>å®ä¾‹åŸå‹ä¸Šçš„<code>isReactComponent</code>å˜é‡åˆ¤æ–­æ˜¯å¦æ˜¯<code>ClassComponent</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token class-name">ClassComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isReactComponent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç»„ä»¶ä¸å…ƒç´ å…³ç³»"></a>ç»„ä»¶ä¸å…ƒç´ å…³ç³»<a class="hash-link" href="#ç»„ä»¶ä¸å…ƒç´ å…³ç³»" title="Direct link to heading">#</a></h3><p><code>React</code> ç»„ä»¶ æ˜¯ç”± <code>UIéƒ¨åˆ†</code> + <code>é€»è¾‘éƒ¨åˆ†</code>ç»„æˆ			<code>UIéƒ¨åˆ†</code> å°±æ˜¯<code>React</code>å…ƒç´ </p><p>å…ƒç´  åœ¨ <code>render</code>é˜¶æ®µ è¢«è½¬æ¢æˆ <code>React Fiber å¯¹è±¡</code></p><p><code>Fiberå¯¹è±¡</code> çš„å±‚å±‚åµŒå¥—å½¢æˆäº†åº”ç”¨ç¨‹åºçš„<code>Fiberæ ‘</code> 		æ‰€æœ‰æ›´æ–°çš„å¤„ç†éƒ½æ˜¯åœ¨è¿™é¢—æ ‘ä¸­è®¡ç®—</p><p><code>React</code> ä¸­ç»„ä»¶å’Œå…ƒç´ çš„æ ¹æœ¬åŒºåˆ«: å…ƒç´ æ™®é€šå¯¹è±¡ï¼Œè€Œç»„ä»¶æ˜¯ç±»å’Œå‡½æ•°ï¼Œå…ƒç´ æ˜¯ç»„ä»¶çš„ä¸€éƒ¨åˆ†ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„<a class="hash-link" href="#æ•°æ®ç»“æ„" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fiberroot"></a><code>FiberRoot</code><a class="hash-link" href="#fiberroot" title="Direct link to heading">#</a></h3><ul><li>è°ƒç”¨<code>createFiberRoot</code> å‡½æ•°è¿”å› <code>FiberRoot</code> å¯¹è±¡</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">FiberRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">RootFiber</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">RootFiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stateNode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">FiberRoot</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>fiberRoot</code> å¯¹è±¡æ˜¯æ•´ä¸ª<code>Fiber</code> æ¶æ„çš„æ ¹èŠ‚ç‚¹å¯¹è±¡</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type BaseFiberRootProperties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// rootèŠ‚ç‚¹ï¼Œrenderæ–¹æ³•æ¥æ”¶çš„ç¬¬äºŒä¸ªå‚æ•°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  containerInfo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åªæœ‰åœ¨æŒä¹…æ›´æ–°ä¸­ä¼šç”¨åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¸æ”¯æŒå¢é‡æ›´æ–°çš„å¹³å°ï¼Œreact-domä¸ä¼šç”¨åˆ°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  pendingChildren</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰åº”ç”¨å¯¹åº”çš„Fiberå¯¹è±¡ï¼Œæ˜¯Root Fiber</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  current</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Fiber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸€ä¸‹çš„ä¼˜å…ˆçº§æ˜¯ç”¨æ¥åŒºåˆ†</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 1) æ²¡æœ‰æäº¤(committed)çš„ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 2) æ²¡æœ‰æäº¤çš„æŒ‚èµ·ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 3) æ²¡æœ‰æäº¤çš„å¯èƒ½è¢«æŒ‚èµ·çš„ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æˆ‘ä»¬é€‰æ‹©ä¸è¿½è¸ªæ¯ä¸ªå•ç‹¬çš„é˜»å¡ç™»è®°ï¼Œä¸ºäº†å…¼é¡¾æ€§èƒ½</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// The earliest and latest priority levels that are suspended from committing.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æœ€è€å’Œæ–°çš„åœ¨æäº¤çš„æ—¶å€™è¢«æŒ‚èµ·çš„ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  earliestSuspendedTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  latestSuspendedTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// The earliest and latest priority levels that are not known to be suspended.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æœ€è€å’Œæœ€æ–°çš„ä¸ç¡®å®šæ˜¯å¦ä¼šæŒ‚èµ·çš„ä¼˜å…ˆçº§ï¼ˆæ‰€æœ‰ä»»åŠ¡è¿›æ¥ä¸€å¼€å§‹éƒ½æ˜¯è¿™ä¸ªçŠ¶æ€ï¼‰</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  earliestPendingTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  latestPendingTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// The latest priority level that was pinged by a resolved promise and can</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// be retried.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æœ€æ–°çš„é€šè¿‡ä¸€ä¸ªpromiseè¢«resloveå¹¶ä¸”å¯ä»¥é‡æ–°å°è¯•çš„ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  latestPingedTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœæœ‰é”™è¯¯è¢«æŠ›å‡ºå¹¶ä¸”æ²¡æœ‰æ›´å¤šçš„æ›´æ–°å­˜åœ¨ï¼Œæˆ‘ä»¬å°è¯•åœ¨å¤„ç†é”™è¯¯å‰åŒæ­¥é‡æ–°ä»å¤´æ¸²æŸ“</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨`renderRoot`å‡ºç°æ— æ³•å¤„ç†çš„é”™è¯¯æ—¶ä¼šè¢«è®¾ç½®ä¸º`true`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  didError</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> boolean</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ­£åœ¨ç­‰å¾…æäº¤çš„ä»»åŠ¡çš„`expirationTime`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  pendingCommitExpirationTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å·²ç»å®Œæˆçš„ä»»åŠ¡çš„FiberRootå¯¹è±¡ï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªRootï¼Œé‚£ä»–æ°¸è¿œåªå¯èƒ½æ˜¯è¿™ä¸ªRootå¯¹åº”çš„Fiberï¼Œæˆ–è€…æ˜¯null</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨commité˜¶æ®µåªä¼šå¤„ç†è¿™ä¸ªå€¼å¯¹åº”çš„ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  finishedWork</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Fiber </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨ä»»åŠ¡è¢«æŒ‚èµ·çš„æ—¶å€™é€šè¿‡setTimeoutè®¾ç½®çš„è¿”å›å†…å®¹ï¼Œç”¨æ¥ä¸‹ä¸€æ¬¡å¦‚æœæœ‰æ–°çš„ä»»åŠ¡æŒ‚èµ·æ—¶æ¸…ç†è¿˜æ²¡è§¦å‘çš„timeout</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  timeoutHandle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TimeoutHandle </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> NoTimeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// é¡¶å±‚contextå¯¹è±¡ï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨`renderSubtreeIntoContainer`æ—¶æ‰ä¼šæœ‰ç”¨</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Object </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  pendingContext</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Object </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ç”¨æ¥ç¡®å®šç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯å¦éœ€è¦èåˆ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">hydrate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> boolean</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰rootä¸Šå‰©ä½™çš„è¿‡æœŸæ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: æåˆ°rendereré‡Œé¢åŒºå¤„ç†</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  nextExpirationTimeToWorkOn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰æ›´æ–°å¯¹åº”çš„è¿‡æœŸæ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  expirationTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// List of top-level batches. This list indicates whether a commit should be</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// deferred. Also contains completion callbacks.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Lift this into the renderer</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// é¡¶å±‚æ‰¹æ¬¡ï¼ˆæ‰¹å¤„ç†ä»»åŠ¡ï¼Ÿï¼‰è¿™ä¸ªå˜é‡æŒ‡æ˜ä¸€ä¸ªcommitæ˜¯å¦åº”è¯¥è¢«æ¨è¿Ÿ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åŒæ—¶åŒ…æ‹¬å®Œæˆä¹‹åçš„å›è°ƒ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è²Œä¼¼ç”¨åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Ÿ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  firstBatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Batch </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// rootä¹‹é—´å…³è”çš„é“¾è¡¨ç»“æ„</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  nextScheduledRoot</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> FiberRoot </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fiber"></a><code>Fiber</code><a class="hash-link" href="#fiber" title="Direct link to heading">#</a></h3><p>è¿™é‡Œå°±æ˜¯createHostRootFiberå‡½æ•°è¿”å›çš„fiberå¯¹è±¡ã€‚æ³¨æ„è¿™é‡Œå…¶å®æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªfiberå¯¹è±¡ï¼Œä¸æ˜¯Rootä¸“æœ‰çš„å“¦ã€‚</p><p><code>FiberNode</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FiberNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">tag</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> pendingProps</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> key</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Instance ä½œä¸ºé™æ€æ•°æ®ç»“æ„çš„å±æ€§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tag</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">elementType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stateNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Fiber ä½œä¸ºæ¶æ„ ç”¨äºè¿æ¥å…¶ä»–FiberèŠ‚ç‚¹å½¢æˆFiberæ ‘</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">return </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sibling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒçš„å±æ€§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pendingProps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pendingProps</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">memoizedProps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">updateQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">memoizedState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contextDependencies </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Effects</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">effectTag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NoEffect</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nextEffect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">firstEffect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastEffect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NoWork</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">childExpirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NoWork</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alternate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Tag</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FunctionComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å‡½æ•°ç»„ä»¶å…ƒç´ å¯¹åº”çš„ Fiber ç»“ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ClassComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Classç»„ä»¶å…ƒç´ å¯¹åº”çš„ Fiber ç»“ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> IndeterminateComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨ä¸ç¡®å®šæ˜¯ Class ç»„ä»¶å…ƒç´ è¿˜æ˜¯å‡½æ•°ç»„ä»¶å…ƒç´ æ—¶çš„å–å€¼ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> HostRoot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹åº” Fiber æ ‘çš„æ ¹ç»“ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> HostPortal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹åº”ä¸€é¢—å­æ ‘ï¼Œå¯ä»¥å¦ä¸€ä¸ªæ¸²æŸ“å™¨çš„å…¥å£</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> HostComponent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å®¿ä¸»ç»„ä»¶å…ƒç´ (å¦‚divï¼Œbuttonç­‰)å¯¹åº”çš„ Fiber ç»“ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> HostText </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// æ–‡æœ¬å…ƒç´ (å¦‚divï¼Œbuttonç­‰)å¯¹åº”çš„ Fiber ç»“ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Fragment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Fiber å¯¹è±¡ä¸­ stateNode å±æ€§ç”¨äºå­˜å‚¨ Fiber ç»“ç‚¹åœ¨æ›´æ–°å®Œæˆåçš„çŠ¶æ€ï¼Œæ¯”å¦‚ HostComponent ç±»å‹çš„ Fiber ç»“ç‚¹çš„stateNode å±æ€§å€¼æ˜¯å…¶ </span><span class="token constant" style="color:#36acaa">DOM</span><span class="token plain"> å…ƒç´ å®ä¾‹ï¼Œ ClassComponent ç±»å‹çš„ Fiber ç»“ç‚¹çš„ stateNode å±æ€§å€¼æ˜¯å…¶ç»„ä»¶å®ä¾‹ã€‚</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HostComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stateNode </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> #div</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> #span</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassComponent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stateNode </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update"></a><code>update</code><a class="hash-link" href="#update" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">expirationTime</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Update</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿‡æœŸæ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    expirationTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> expirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// export const UpdateState = 0; // æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// export const ForceUpdate = 2; // å¼ºåˆ¶æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tag</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UpdateState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°å†…å®¹ï¼Œæ¯”å¦‚`setState`æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬ä¸€æ¬¡æ¸²æŸ“ReactDOM.renderæ¥æ”¶çš„æ˜¯payload = {element};</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°å®Œæˆåå¯¹åº”çš„å›è°ƒï¼Œ`setState`ï¼Œ`render`éƒ½æœ‰</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    callback</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æŒ‡å‘ä¸‹ä¸€ä¸ªæ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æŒ‡å‘ä¸‹ä¸€ä¸ª`side effect`ï¼Œè¿™å—å†…å®¹åç»­è®²è§£</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    nextEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="queue"></a><code>queue</code><a class="hash-link" href="#queue" title="Direct link to heading">#</a></h3><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211001131544.png" alt="image-20211001131543806"></p><p>UpdateQueueæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ç»“æ„ï¼Œç”¨æ¥å­˜æ”¾updateã€‚æ¯ä¸ªupdateç”¨nextè¿æ¥ã€‚å®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºæ›´æ–°é˜Ÿåˆ—</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> createUpdateQueue</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">State</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">baseState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> State</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UpdateQueue</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">State</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> queue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UpdateQueue</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">State</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åº”ç”¨æ›´æ–°åçš„state</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ¯æ¬¡çš„æ›´æ–°éƒ½æ˜¯åœ¨è¿™ä¸ªbaseStateåŸºç¡€ä¸Šè¿›è¡Œæ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªupdate</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstUpdate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é˜Ÿåˆ—ä¸­çš„æœ€åä¸€ä¸ªupdate</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastUpdate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ•è·ç±»å‹çš„update</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstCapturedUpdate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ•è·ç±»å‹çš„update</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastCapturedUpdate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬ä¸€ä¸ªside effect</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æœ€åä¸€ä¸ªside effect</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ•è·äº§ç”Ÿçš„`side effect`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstCapturedEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastCapturedEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="effecttag"></a><code>effectTag</code><a class="hash-link" href="#effecttag" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Placement</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*                */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b00000000000010</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// DOMéœ€è¦æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Update</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*                   */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b00000000000100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­å¹¶æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">PlacementAndUpdate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*       */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b00000000000110</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// DOMéœ€è¦åˆ é™¤</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Deletion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*                 */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b00000000001000</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">effectTag å±æ€§çš„å–å€¼ä»¥åŠå…¶ä½è¿ç®—</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">effectTag æ˜¯æ„é€ å‡½æ•° </span><span class="token maybe-class-name">FiberNode</span><span class="token plain"> çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒç”¨äºæ ‡è¯†å½“å‰ </span><span class="token maybe-class-name">Fiber</span><span class="token plain"> ç»“ç‚¹çš„ã€Œæ›´æ–°ã€ç±»å‹</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">NoEffect</span><span class="token plain"> ä¸€èˆ¬ä½œä¸º </span><span class="token maybe-class-name">EffectTag</span><span class="token plain"> çš„åˆå§‹å€¼ï¼Œæˆ–è€…ç”¨äº </span><span class="token maybe-class-name">EffectTag</span><span class="token plain"> çš„æ¯”è¾ƒåˆ¤æ–­ï¼Œå…¶å€¼ä¸º </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> è¡¨ç¤ºæ²¡æœ‰å‰¯ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸æ¶‰ åŠæ›´æ–°ã€‚</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">JS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> æŒ‰ä½æˆ– æŒ‰ä½ä¸ </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> æ“ä½œå¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªå˜é‡ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå±æ€§</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="expirationtime"></a><code>expirationTime</code><a class="hash-link" href="#expirationtime" title="Direct link to heading">#</a></h3><ul><li>åœ¨ <code>React</code> ä¸­ï¼Œä¸ºé˜²æ­¢æŸä¸ª <code>update</code> å› ä¸ºä¼˜å…ˆçº§çš„åŸå› ä¸€ç›´è¢«æ‰“æ–­è€Œæœªèƒ½æ‰§è¡Œï¼Œ<code>React</code>  ä¼šè®¾ç½®ä¸€ä¸ª <code>expirationTime</code> ï¼Œå½“æ—¶é—´åˆ°äº† <code>expirationTime</code> çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ª <code>update</code> è¿˜æœªæ‰§è¡Œçš„è¯ï¼Œ<code>React</code>  å°†ä¼šå¼ºåˆ¶æ‰§è¡Œè¯¥ <code>update</code> ï¼Œè¿™å°±æ˜¯ <code>expirationTime</code> çš„ä½œç”¨ã€‚</li></ul><p>// fiberå¯¹è±¡çš„ ä¸updateå¯¹è±¡çš„æ˜¯ä¸€æ ·çš„å—</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="expirationtime-å–å€¼"></a><code>ExpirationTime</code> å–å€¼<a class="hash-link" href="#expirationtime-å–å€¼" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// å®šä¹‰äº†è¿‡æœŸæ—¶é—´çš„æœ€å¤§å€¼Math.pow(2, 30) - 1 </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 0b111111111111111111111111111111</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAX_SIGNED_31_BIT_INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1073741823</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// NoWorkè¡¨ç¤ºä¸éœ€è¦æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">NoWork</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Neverè¡¨ç¤ºæ›´æ–°çš„è¿‡æœŸæ—¶é—´å¾ˆå°ï¼Œå¯ä»¥æ— é™è¢«å»¶æœŸ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Never</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Syncè¡¨ç¤ºæ‹¥æœ‰æœ€å¤§è¿‡æœŸæ—¶é—´çš„æ›´æ–°éœ€è¦ç«‹å³æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åŒæ­¥æ‰§è¡Œ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Sync</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAX_SIGNED_31_BIT_INT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Batchedè¡¨ç¤ºæ‰¹é‡æ›´æ–°çš„è¿‡æœŸæ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Batched</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Sync</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNIT_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAGIC_NUMBER_OFFSET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Batched</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä¼˜å…ˆçº§-ç«‹å³æ‰§è¡Œ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 32ä½ç³»ç»Ÿåœ¨V8ä¸­çš„æœ€å¤§æ•´æ•°å¤§å° Math.pow(2, 30) - 1 = 0b111111111111111111111111111111 </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> maxSigned31BitInt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1073741823</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç«‹å³è¿‡æœŸ/é¥¥é¥¿çš„ä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IMMEDIATE_PRIORITY_TIMEOUT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç”¨æˆ·é˜»å¡ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´250ms</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">USER_BLOCKING_PRIORITY</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ­£å¸¸ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´5000ms</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NORMAL_PRIORITY_TIMEOUT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´10000ms</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">LOW_PRIORITY_TIMEOUT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æœ€ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´maxSigned31BitInt(å¤§çº¦12å¤©åè¿‡æœŸ)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IDLE_PRIORITY</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxSigned31BitInt</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä»»åŠ¡ä¼˜å…ˆçº§"></a>ä»»åŠ¡ä¼˜å…ˆçº§<a class="hash-link" href="#ä»»åŠ¡ä¼˜å…ˆçº§" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ç«‹å³æ‰§è¡Œ(å¯ç”±é¥¥é¥¿ä»»åŠ¡è½¬æ¢)ï¼Œæœ€é«˜ä¼˜å…ˆçº§ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">ImmediatePriority</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç”¨æˆ·é˜»å¡çº§åˆ«(å¦‚å¤–éƒ¨äº‹ä»¶)ï¼Œæ¬¡é«˜ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">UserBlockingPriority</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ™®é€šä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">NormalPriority</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä½ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">LowPriority</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æœ€ä½ä¼˜å…ˆçº§ï¼Œç©ºé—²æ—¶å»æ‰§è¡Œ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">IdlePriority</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>React</code> åœ¨è®¡ç®—å½“å‰ <code>Fiber</code> ç»“ç‚¹æ›´æ–°å¯¹è±¡çš„è¿‡æœŸæ—¶é—´æ—¶ï¼Œä¼šå‘å…¶ä»»åŠ¡è°ƒåº¦å™¨æŸ¥è¯¢è¯¥æ›´æ–°å¯¹è±¡åº”è¯¥ä»€ä¹ˆæ ·çš„ä¼˜å…ˆçº§ã€‚ä»»åŠ¡è°ƒåº¦å™¨ä¼šæ ¹æ®å½“å‰è®¡ç®—æœºèµ„æº<code>(å¦‚ CPU)</code>çš„ä½¿ç”¨æƒ…å†µè¿”å›åˆé€‚çš„ä¼˜å…ˆçº§</li><li>ä»»åŠ¡è°ƒåº¦å™¨ä¼šé€šè¿‡ <code>performance.now() + timeout</code> æ¥è®¡ç®—å‡ºä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå½“å‰æ—¶é—´ä¼šè¶Šæ¥è¶Šæ¥è¿‘è¿™ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥è¿‡æœŸæ—¶é—´è¶Šå°çš„ä»£è¡¨ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»æ¯”å½“å‰æ—¶é—´å°äº†ï¼Œè¯´æ˜è¿™ä¸ªä»»åŠ¡å·²ç»è¿‡æœŸäº†è¿˜æ²¡æ‰§è¡Œï¼Œéœ€è¦ç«‹é©¬å»æ‰§è¡Œã€‚</li><li><code>window.performance.now</code> æ˜¯æµè§ˆå™¨å†…ç½®çš„æ—¶é’Ÿï¼Œä»é¡µé¢åŠ è½½å¼€å§‹è®¡æ—¶ï¼Œè¿”å›åˆ°å½“å‰çš„æ€»æ—¶é—´ï¼Œå•ä½ ms</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="computeexpirationforfiber"></a><code>computeExpirationForFiber</code><a class="hash-link" href="#computeexpirationforfiber" title="Direct link to heading">#</a></h4><p><code>var expirationTime = computeExpirationForFiber(currentTime, fiber)</code></p><ul><li><code>computeExpirationForFiber</code> å‡½æ•°çš„ä½œç”¨æ˜¯ä¸º <code>Fiber</code> ç»“ç‚¹è®¡ç®—è¿‡æœŸæ—¶é—´</li></ul><p>è°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º</p><ul><li>å…ˆè·å–å½“å‰æ›´æ–°ä»»åŠ¡çš„ä¼˜å…ˆçº§</li><li>æ ¹æ®ä¼˜å…ˆçº§å¾—å‡º <code>expirationTime</code>  åœ¨è¿™è¿‡ç¨‹ä¸­ ä¼šè°ƒç”¨ <code>computeInteractiveExpiration | computeAsyncExpiration</code></li><li>è¿™ä¸¤ä¸ªæ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ <code>computeExpirationBucket</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211001093657.png" alt="image-20211001093656551"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeExpirationForFiber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">currentTime</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–å½“å‰æ›´æ–°ä»»åŠ¡çš„ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> priorityLevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unstable_getCurrentPriorityLevel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token maybe-class-name">ConcurrentMode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token maybe-class-name">NoContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Outside of concurrent mode, updates are always synchronous.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Sync</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isWorking </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">isCommitting$</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// During render phase, updates expire during as the current render.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nextRenderExpirationTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priorityLevel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> unstable_ImmediatePriority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Sync</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> unstable_UserBlockingPriority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// äº¤äº’å¼•èµ·çš„æ›´æ–° </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeInteractiveExpiration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currentTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> unstable_NormalPriority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// This is a normal, concurrent update æ™®é€šå¼‚æ­¥æ›´æ–°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeAsyncExpiration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">currentTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> unstable_LowPriority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> unstable_IdlePriority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        expirationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Never</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> expirationTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// é«˜ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HIGH_PRIORITY_EXPIRATION</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __DEV__ </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HIGH_PRIORITY_BATCH_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeInteractiveExpiration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">currentTime</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> ExpirationTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeExpirationBucket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">HIGH_PRIORITY_EXPIRATION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//150</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">HIGH_PRIORITY_BATCH_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//100</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä½ä¼˜å…ˆçº§</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">LOW_PRIORITY_EXPIRATION</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">LOW_PRIORITY_BATCH_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeAsyncExpiration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter">currentTime</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> ExpirationTime</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ExpirationTime</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeExpirationBucket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">LOW_PRIORITY_EXPIRATION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//5000</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">LOW_PRIORITY_BATCH_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//250</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNIT_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAGIC_NUMBER_OFFSET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ceiling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">num</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> number</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> precision</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// | 0 ä¸ºå–æ•´æ“ä½œ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> precision</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> precision</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">computeExpirationBucket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter">currentTime</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"></span></span><span class="token-line" style="color:#393A34"><span class="token parameter">  expirationInMs</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"></span></span><span class="token-line" style="color:#393A34"><span class="token parameter">  bucketSizeMs</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ExpirationTime</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">MAGIC_NUMBER_OFFSET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ceiling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentTime </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAGIC_NUMBER_OFFSET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> expirationInMs </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNIT_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      bucketSizeMs </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNIT_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>ä½ä¼˜å…ˆçº§æ›´æ–°çš„ <code>expirationTime</code> é—´éš”æ˜¯25msï¼ŒæŠ¹å¹³äº†25mså†…è®¡ç®—è¿‡æœŸæ—¶é—´çš„è¯¯å·®ï¼Œ<code>React</code>è®©ä¸¤ä¸ªç›¸è¿‘ <code>update</code> ï¼ˆ25mså†…ï¼‰çš„å¾—åˆ°ç›¸åŒçš„ <code>expirationTime</code>ï¼Œç›®çš„å°±æ˜¯è®©è¿™ä¸¤ä¸ª<code>update</code>è‡ªåŠ¨åˆå¹¶æˆä¸€ä¸ª<code>update</code>ï¼Œä»è€Œè¾¾åˆ°æ‰¹é‡æ›´æ–°ã€‚</li><li>è¿™é‡Œå¦‚æœç”¨é«˜ä¼˜å…ˆçº§æ›´æ–°å»å°è¯•å¤šç»„æ•°æ®ï¼Œä½ ä¼šå‘ç° <code>expirationTime</code> é—´éš”æ˜¯10ms</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="task"></a><code>task</code><a class="hash-link" href="#task" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡çš„å›è°ƒå‡½æ•°ï¼Œä¸»è¦ç”¨äºå’Œå…¶ä»–æ¡†æ¶çš„é“¾æ¥ï¼Œæ¯”å¦‚React fiber </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  callback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§åˆ«è¶Šé«˜</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  priorityLevel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡å¼€å§‹æ‰§è¡Œæ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  startTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å–å€¼è§ä»£ç ç¤ºä¾‹4-2-3 </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  expirationTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸‹ä¸€ä¸ªä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸Šä¸€ä¸ªä»»åŠ¡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  previous</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>ã€Œä»»åŠ¡ã€æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼ŒReact ç»™ã€Œä»»åŠ¡ã€å®šä¹‰äº†æ•°æ®ç»“æ„ï¼Œä½¿å…¶å…·æœ‰è¿‡æœŸæ—¶é—´ã€ä¸‹ä¸€ä¸ªä»»åŠ¡å’Œä¸Šä¸€ä¸ªä»»åŠ¡ç­‰ å±æ€§ï¼Œå¤šä¸ªä»»åŠ¡å¯¹è±¡é“¾æ¥æˆä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ã€‚</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="taskqueue"></a><code>taskQueue</code><a class="hash-link" href="#taskqueue" title="Direct link to heading">#</a></h3><p><img src="https://cdn.jsdelivr.net/gh/honjaychang/bp/fe/20211001095608.png" alt="image-20211001095608588"></p><p>ä»»åŠ¡è°ƒåº¦å™¨ä¸­ç»´æŠ¤çš„ä»»åŠ¡é˜Ÿåˆ—åœ¨å†…å­˜ä¸­çš„ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œæ¯ä¸ª <code>task</code> å¯¹è±¡å¯ä»¥é€šè¿‡ <code>previous</code> å’Œ <code>next</code>æ‰¾åˆ° å…¶ä¸Šä¸€ä¸ªä»»åŠ¡å’Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ä»»åŠ¡è°ƒåº¦å™¨</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">ä¸ºä»»åŠ¡ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—çš„ç»“æ„æ˜¯ </span><span class="token function" style="color:#d73a49">åŒå‘å¾ªç¯é“¾è¡¨ï¼Œä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">çš„è¿‡ç¨‹ä¹Ÿæ˜¯å°†æ‰€æœ‰ä»»åŠ¡æ ¹æ®è¿‡æœŸæ—¶é—´è¿›è¡Œæ’åºçš„è¿‡ç¨‹</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">insertScheduledTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newTask</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> expirationTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">å°†ä»»åŠ¡æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—å…¶å®å°±æ˜¯ä¸€ä¸ªå¤„ç†åŒå‘é“¾è¡¨çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä½¿ç”¨   èµ°å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œå½“ æ‰¾åˆ°æ­£ç¡®çš„ç»“ç‚¹ä½ç½®æ—¶ä½¿ç”¨ next å’Œ previous æŒ‡é’ˆå°†æ–°ç»“ç‚¹å’Œé“¾è¡¨ä¸­å·²æœ‰çš„ç»“ç‚¹ä¸²è”èµ·æ¥ã€‚ä»»åŠ¡åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—åï¼Œ </span><span class="token function" style="color:#d73a49">ä»»åŠ¡é˜Ÿåˆ—</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskQueue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">ä¼šå½¢æˆä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="current-wip"></a><code>current wIP</code><a class="hash-link" href="#current-wip" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fiber-æ ‘"></a><code>Fiber</code> æ ‘<a class="hash-link" href="#fiber-æ ‘" title="Direct link to heading">#</a></h3><p>é¦–å…ˆå¾—å…ˆäº†è§£<code>Fiber</code> æ ‘</p><p><code>Fiber</code> æ ‘å…¶å®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é€šè¿‡å±‚å±‚ <code>Fiber</code> ç»“ç‚¹çš„åµŒå¥—å½¢æˆäº†ä¸€ä¸ªã€Œæ ‘ã€å½¢ç»“æ„ï¼Œåœ¨æ•°æ®ç»“æ„å±‚é¢å®ƒæ˜¯ä¸€ä¸ªã€Œé“¾è¡¨ã€ã€‚<code>Fiber</code> æ ‘çš„æ ¹ç»“ç‚¹æ˜¯ <code>HostRoot</code> ç±»å‹çš„ <code>FiberNode</code> å®ä¾‹ã€‚<code>Fiber</code> ç»“ç‚¹ä¸­çš„ <code>returnã€ child å’Œ sibling</code> ä¸‰ä¸ªå±æ€§åˆ†åˆ«ç”¨äºæŒ‡å‘çˆ¶ç»“ç‚¹ï¼Œç¬¬ä¸€ä¸ªå­©å­ç»“ç‚¹å’Œå…„å¼Ÿç»“ç‚¹ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="current-æ ‘"></a><code>current</code> æ ‘<a class="hash-link" href="#current-æ ‘" title="Direct link to heading">#</a></h3><p><code>current</code> æ ‘æ˜¯ <code>fiberRoot</code> å¯¹è±¡ä¸Šé¢ <code>current</code> å±æ€§æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”±ä¼—å¤š <code>Fiber</code> ç»“ç‚¹è¿æ¥è€Œæˆã€‚ <code>current</code> æ ‘æè¿°çš„æ˜¯åº”ç”¨ç¨‹åºæ¸²æŸ“å®Œæˆåæœ€ç»ˆçš„ <code>Fiber</code> ç»“æ„ï¼Œå®ƒåæ˜ äº†ç”¨äºæ¸²æŸ“ UI çš„çŠ¶æ€ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wip-æ ‘"></a><code>wIP</code> æ ‘<a class="hash-link" href="#wip-æ ‘" title="Direct link to heading">#</a></h3><p><code>workInProgress</code> æ ‘æ˜¯ <code>fiberRoot</code> å¯¹è±¡ä¸Šé¢ <code>current</code> å±æ€§æŒ‡å‘çš„å¯¹è±¡ä¸Šé¢ <code>alternate</code> å±æ€§æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æ¸²æŸ“ç»“æŸåè¯¥å¯¹è±¡è¢«èµ‹å€¼ç»™ <code>current</code> ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>workInProgress</code>  æ ‘æ˜¯ <code>current</code> æ ‘çš„ä¸­é—´å½¢æ€ã€‚ </p><p>// key ä¸€è‡´æ€§. å…¶ä»–åŸåˆ™å‘¢</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä¸¤è€…å…³ç³»"></a>ä¸¤è€…å…³ç³»<a class="hash-link" href="#ä¸¤è€…å…³ç³»" title="Direct link to heading">#</a></h3><blockquote><p><code>React</code> çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€: ä¸€è‡´æ€§ã€‚ <code>React</code> æ€»æ˜¯ä¸€æ¬¡æ€§æ›´æ–° <code>DOM</code> (ä¸ä¼šæ˜¾ç¤ºéƒ¨åˆ†ä¸­é—´ç»“æœ)ã€‚å› æ­¤ï¼Œ<code>wIP</code>  æ ‘å°±å……å½“ç”¨æˆ·ä¸å¯è§çš„ã€Œè‰ç¨¿ã€ï¼Œè¿™æ · <code>React</code> å¯ä»¥å…ˆå¤„ç†æ‰€æœ‰ç»„ä»¶ï¼Œç„¶åå°†æ›´æ–°ç»Ÿä¸€åˆ·æ–°åˆ°å±å¹•ã€‚</p></blockquote><p>æ‰€æœ‰æ›´æ–°è®¡ç®—ç›¸å…³çš„å·¥ä½œéƒ½åœ¨ <code>workInProgress</code>  æ ‘çš„ <code>Fiber</code>  ç»“ç‚¹ä¸Šæ‰§è¡Œã€‚å¤„ç†å®Œæ›´æ–°å¹¶å®Œæˆæ‰€æœ‰ç›¸å…³å·¥ä½œåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå¸¦æœ‰æ›´æ–°æ ‡è¯†çš„ <code>Fiber</code>  ç»“ç‚¹é“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯å‰¯ä½œç”¨é“¾è¡¨ï¼Œå®ƒæ˜¯ <code>workInProgress</code>  æ ‘çš„å­é›†ã€‚<code>React</code> å°†å‰¯ä½œç”¨é“¾è¡¨æ˜ å°„åˆ°å±å¹•ä¸Šåï¼Œ<code>workInProgress</code> å°±ä¼šå˜æˆ <code>current</code> æ ‘</p><p>è¿™ç§<strong>åœ¨å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢</strong>çš„æŠ€æœ¯å«åšåŒç¼“å­˜</p><p><code>React</code>ä½¿ç”¨â€œåŒç¼“å­˜â€æ¥å®Œæˆ<code>Fiberæ ‘</code>çš„æ„å»ºä¸æ›¿æ¢â€”â€”å¯¹åº”ç€<code>DOMæ ‘</code>çš„åˆ›å»ºä¸æ›´æ–°</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// fiberRoot.current.alternateä¸ºworkInProgressæ ‘</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// å°†workInProgressæ ‘çš„å¼•å…¥å­˜å…¥åˆ°finishedWorkå˜é‡ä¸­ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> finishedWork </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fiberRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">alternate</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// å°†fiberRoot.current.alternateæŒ‡å‘çš„å†…å­˜åˆ¶ä¸ºnull</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">fiberRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// å°†workInProgressæ ‘èµ‹å€¼ç»™currentæ ‘</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">fiberRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> finishedWork</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shallowequal"></a><code>shallowEqual</code><a class="hash-link" href="#shallowequal" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">shallowEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">objA</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> objB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> objB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> objA </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    objA </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> objB </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    objB </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> keysA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> keysB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keysA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> keysB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Test for A&#x27;s keys different from B.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> keysA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">!</span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hasOwnProperty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keysA</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objA</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">keysA</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> objB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">keysA</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scheduleæš´éœ²å‡ºçš„å±æ€§æ–¹æ³•"></a><code>schedule</code>æš´éœ²å‡ºçš„å±æ€§æ–¹æ³•<a class="hash-link" href="#scheduleæš´éœ²å‡ºçš„å±æ€§æ–¹æ³•" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡ä¼˜å…ˆçº§æ ‡è¯†</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">ImmediatePriority</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_ImmediatePriority</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">UserBlockingPriority</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_UserBlockingPriority</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">NormalPriority</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_NormalPriority</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">IdlePriority</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_IdlePriority</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">LowPriority</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_LowPriority</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¸¸ç”¨çš„ä»»åŠ¡å¤„ç†æ–¹æ³•</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_runWithPriority</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_next</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_scheduleCallback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_cancelCallback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_wrapCallback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unstable_getCurrentPriorityLevel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_shouldYield</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_requestPaint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_continueExecution</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unstable_pauseExecution</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  unstable_getFirstCallbackNode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  getCurrentTime </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_now</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  forceFrameRate </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> unstable_forceFrameRate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4>Â·Â·</h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> deadlineObject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  timeRemaining</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰å¸§è¿˜æœ‰å¤šå°‘ç©ºé—²æ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  didTimeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ä»»åŠ¡æ˜¯å¦è¿‡æœŸ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/reactCore/basic"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ä¸€äº›æ¦‚å¿µ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reactCore/createUpdate"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">æ›´æ–° Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reactå…ƒç´ " class="table-of-contents__link">Reactå…ƒç´ </a><ul><li><a href="#jsx" class="table-of-contents__link"><code>JSX</code></a></li><li><a href="#reactcreateelement" class="table-of-contents__link"><code>React.createElement</code></a></li><li><a href="#react-element" class="table-of-contents__link"><code>React element</code></a></li><li><a href="#react-component" class="table-of-contents__link"><code>react Component</code></a></li><li><a href="#ç»„ä»¶ä¸å…ƒç´ å…³ç³»" class="table-of-contents__link">ç»„ä»¶ä¸å…ƒç´ å…³ç³»</a></li></ul></li><li><a href="#æ•°æ®ç»“æ„" class="table-of-contents__link">æ•°æ®ç»“æ„</a><ul><li><a href="#fiberroot" class="table-of-contents__link"><code>FiberRoot</code></a></li><li><a href="#fiber" class="table-of-contents__link"><code>Fiber</code></a></li><li><a href="#update" class="table-of-contents__link"><code>update</code></a></li><li><a href="#queue" class="table-of-contents__link"><code>queue</code></a></li><li><a href="#effecttag" class="table-of-contents__link"><code>effectTag</code></a></li><li><a href="#expirationtime" class="table-of-contents__link"><code>expirationTime</code></a></li><li><a href="#task" class="table-of-contents__link"><code>task</code></a></li><li><a href="#taskqueue" class="table-of-contents__link"><code>taskQueue</code></a></li></ul></li><li><a href="#current-wip" class="table-of-contents__link"><code>current wIP</code></a><ul><li><a href="#fiber-æ ‘" class="table-of-contents__link"><code>Fiber</code> æ ‘</a></li><li><a href="#current-æ ‘" class="table-of-contents__link"><code>current</code> æ ‘</a></li><li><a href="#wip-æ ‘" class="table-of-contents__link"><code>wIP</code> æ ‘</a></li><li><a href="#ä¸¤è€…å…³ç³»" class="table-of-contents__link">ä¸¤è€…å…³ç³»</a></li></ul></li><li><a href="#shallowequal" class="table-of-contents__link"><code>shallowEqual</code></a></li><li><a href="#scheduleæš´éœ²å‡ºçš„å±æ€§æ–¹æ³•" class="table-of-contents__link"><code>schedule</code>æš´éœ²å‡ºçš„å±æ€§æ–¹æ³•</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.b087496d.js"></script>
<script src="/assets/js/main.9cb9d5d7.js"></script>
</body>
</html>